import*as e from"react";import t,{Component as n,useState as r,useMemo as a,useRef as s,useEffect as o,useCallback as i}from"react";import l from"prop-types";import{format as c}from"d3-format";import{timeFormat as h,timeParse as u}from"d3-time-format";import{scaleLinear as d,scaleLog as p}from"d3-scale";import{curveStepAfter as m}from"d3-shape";import{withSize as f,withDeviceRatio as g,pointAndFigure as v,kagi as b,renko as y,heikinAshi as C,discontinuousTimeScaleProviderBuilder as w,ChartCanvas as P,lastVisibleItemBasedZoomAnchor as E,Chart as S,BarSeries as x,XAxis as D,MouseCoordinateX as k,YAxis as A,MouseCoordinateY as M,EdgeIndicator as T,ZoomButtons as I,CrossHairCursor as _,CandlestickSeries as O,PointAndFigureSeries as N,KagiSeries as F,RenkoSeries as R,OHLCSeries as L,ScatterSeries as H,CircleMarker as j,AreaSeries as X,AreaOnlySeries as Y,LineSeries as B}from"react-financial-charts";import{tsvParse as W}from"d3-dsv";function z(){return z=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},z.apply(this,arguments)}function V(e,t){let n,r;for(const t of e)null!=t&&(void 0===n?t>=t&&(n=r=t):(n>t&&(n=t),r<t&&(r=t)));return[n,r]}function $(e,t){let n;if(void 0===t)for(const t of e)null!=t&&(n<t||void 0===n&&t>=t)&&(n=t);else{let r=-1;for(let a of e)null!=(a=t(a,++r,e))&&(n<a||void 0===n&&a>=a)&&(n=a)}return n}function U(e,t){let n;if(void 0===t)for(const t of e)null!=t&&(n>t||void 0===n&&t>=t)&&(n=t);else{let r=-1;for(let a of e)null!=(a=t(a,++r,e))&&(n>a||void 0===n&&a>=a)&&(n=a)}return n}const Z=e=>e;const q=(e,t,n)=>{let r=0,a=e.length-1;for(;a-r>1;){const s=Math.round((r+a)/2);n(e[s])<=t?r=s:a=s}const s=n(e[r]),o=n(e[a]);return(null==s?void 0:s.valueOf())===(null==t?void 0:t.valueOf())&&(a=r),(null==o?void 0:o.valueOf())===(null==t?void 0:t.valueOf())&&(r=a),s<t&&o<t&&(r=a),s>t&&o>t&&(a=r),{left:r,right:a}},G=(e,t)=>{if(e===t)return!0;if(!(e instanceof Object&&t instanceof Object))return!1;const n=Object.keys(e),r=n.length;for(let e=0;e<r;e++)if(!(n[e]in t))return!1;for(let a=0;a<r;a++)if(e[n[a]]!==t[n[a]])return!1;return r===Object.keys(t).length},K=e=>"function"==typeof e?e:()=>e;function J(e){return e&&(e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView)}const Q="mouseenter.interaction",ee="mouseleave.interaction",te="mousemove.pan",ne="mouseup.pan",re="touchmove.pan",ae="touchend.pan touchcancel.pan";function se(e){return{pageX:e.pageX,pageY:e.pageY,clientX:e.clientX,clientY:e.clientY}}function oe(e,t){if(t&&e){let n;for(let r=0;r<e.length;r++)if(n=e[r],le(t(n)))return n;return}return e?e[0]:void 0}function ie(e,t){const n=e?e.length:0;return n?e[n-1]:void 0}const le=e=>null!=e;function ce(e){return!le(e)}function he(e,t){const n=t.currentTarget,r=n.getBoundingClientRect(),a=e.clientX-r.left-n.clientLeft,s=e.clientY-r.top-n.clientTop;return[Math.round(a),Math.round(s)]}function ue(e,t){const n=e.currentTarget,r=null!=t?t:n.getBoundingClientRect(),a=e.clientX-r.left-n.clientLeft,s=e.clientY-r.top-n.clientTop;return[Math.round(a),Math.round(s)]}function de(e,t){e.forEach(e=>{e.setTransform(1,0,0,1,0,0),e.clearRect(-1,-1,e.canvas.width+2,e.canvas.height+2),e.scale(t,t)})}var pe="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function me(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var fe=1/0,ge=9007199254740991,ve="[object Arguments]",be="[object Function]",ye="[object GeneratorFunction]",Ce="object"==typeof pe&&pe&&pe.Object===Object&&pe,we="object"==typeof self&&self&&self.Object===Object&&self,Pe=Ce||we||Function("return this")(),Ee=Object.prototype,Se=Ee.hasOwnProperty,xe=Ee.toString,De=Pe.Symbol,ke=Ee.propertyIsEnumerable,Ae=De?De.isConcatSpreadable:void 0;function Me(e,t,n,r,a){var s=-1,o=e.length;for(n||(n=Te),a||(a=[]);++s<o;){var i=e[s];n(i)?Me(i,t-1,n,r,a):a[a.length]=i}return a}function Te(e){return Ie(e)||function(e){return function(e){return function(e){return!!e&&"object"==typeof e}(e)&&function(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=ge}(e.length)&&!function(e){var t=function(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}(e)?xe.call(e):"";return t==be||t==ye}(e)}(e)}(e)&&Se.call(e,"callee")&&(!ke.call(e,"callee")||xe.call(e)==ve)}(e)||!!(Ae&&e&&e[Ae])}var Ie=Array.isArray;var _e=function(e){return(e?e.length:0)?Me(e,fe):[]},Oe=me(_e);const Ne={flipYScale:!1,id:0,origin:[0,0],padding:0,yPan:!0,yPanEnabled:!1,yScale:d()};function Fe(e){return t=>{const n=e(t);return function(e){return le(e)&&"object"==typeof e&&!Array.isArray(e)}(n)?function(e={},t=e=>e){const n=Object.keys(e),r=new Array(n.length);return n.forEach((n,a)=>{r[a]=t(e[n],n,e)}),r}(n):n}}function Re(e){if(Array.isArray(e)&&2===e.length){const[t,n]=e;return"number"==typeof t&&"number"==typeof n}return!1}function Le(t,n,r=[]){return e.Children.map(n,e=>{if(!e||(void 0===(n=e.props)||void 0===n.id))return;var n;const a=Object.assign(Object.assign({},Ne),e.props),{id:s,origin:o,padding:i,yExtents:l,yScale:c=Ne.yScale,flipYScale:h,yExtentsCalculator:u}=a,d=c.copy(),{width:p,height:m,availableHeight:f}=function({width:e,height:t},n){return{availableHeight:t,width:e,height:n.height||t}}(t,a),{yPan:g}=a;let{yPanEnabled:v}=a;const b=l?(Array.isArray(l)?l:[l]).map(K):void 0,y=r.find(e=>e.id===s);if(Re(l))if(y&&y.yPan&&y.yPanEnabled&&g&&v&&G(y.originalYExtentsProp,l))d.domain(y.yScale.domain());else{const[e,t]=l;d.domain([e,t])}else y&&y.yPanEnabled&&(Re(y.originalYExtentsProp)||(d.domain(y.yScale.domain()),v=!0));return{id:s,origin:K(o)(p,f),padding:i,originalYExtentsProp:l,yExtents:b,yExtentsCalculator:u,flipYScale:h,yScale:d,yPan:g,yPanEnabled:v,width:p,height:m}}).filter(e=>void 0!==e)}function He(e,t){return e.filter(e=>{const n=e.origin[1],r=n+e.height;return t[1]>n&&t[1]<r}).map(e=>e.id)}function je(e,{plotData:t,xAccessor:n,displayXAccessor:r,fullData:a},s,o,i){const l=e.map(({yExtentsCalculator:e,yExtents:i,yScale:l})=>{const c=e?e({plotData:t,xDomain:s,xAccessor:n,displayXAccessor:r,fullData:a}):function(e,t,n){const r=e.map(e=>n.map(Fe(e))),a=Oe(r);return t.invert?V(a):[...new Set(a).values()]}(i,l,t);return{realYDomain:c,yDomainDY:void 0!==o?l.range().map(e=>e-o).map(l.invert):l.domain(),prevYDomain:l.domain()}}),c=function(){let e=Z;function t(){var t;const r=arguments.length;if(0===r)return[];const a=null!==(t=U(arguments,n))&&void 0!==t?t:0,s=new Array(a);for(let t=-1;++t<a;){for(let e=-1,n=s[t]=new Array(r);++e<r;)n[e]=arguments[e][t];s[t]=e.apply(this,s[t])}return s}function n(e){return e.length}return t.combine=function(n){return arguments.length?(e=n,t):e},t}().combine((e,{realYDomain:t,yDomainDY:n,prevYDomain:r})=>{const{id:a,padding:s,height:o,yScale:l,yPan:c,flipYScale:h,yPanEnabled:u=!1}=e,d=void 0===i||i.indexOf(a)>-1,p=c&&u?d?n:r:t,m=function(e,t,n,r){if(e.rangeRoundPoints||ce(e.invert)){if(isNaN(n))throw new Error("padding has to be a number for ordinal scale");e.rangeRoundPoints&&e.rangeRoundPoints(r?[0,t]:[t,0],n),e.rangeRound&&e.range(r?[0,t]:[t,0]).padding(n)}else{const{top:a,bottom:s}=isNaN(n)?n:{top:n,bottom:n};e.range(r?[a,t-s]:[t-s,a])}return e}(l.copy().domain(p),o,s,h);return Object.assign(Object.assign({},e),{yScale:m,realYDomain:t})});return c(e,l)}function Xe(e,t,n,r){let a,s;if(e.invert)a=e.invert(n[0]),s=((e,t,n)=>{const{left:r,right:a}=q(e,t,n);if(r===a)return e[r];const s=n(e[r]),o=n(e[a]);return Math.abs(s.valueOf()-t.valueOf())<Math.abs(o.valueOf()-t.valueOf())?e[r]:e[a]})(r,a,t);else{const t=e.range().map((e,t)=>({x:Math.abs(e-n[0]),idx:t})).reduce((e,t)=>e.x<t.x?e:t);s=void 0!==t?r[t.idx]:r[0]}return s}var Ye="http://www.w3.org/1999/xhtml",Be={svg:"http://www.w3.org/2000/svg",xhtml:Ye,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function We(e){var t=e+="",n=t.indexOf(":");return n>=0&&"xmlns"!==(t=e.slice(0,n))&&(e=e.slice(n+1)),Be.hasOwnProperty(t)?{space:Be[t],local:e}:e}function ze(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===Ye&&t.documentElement.namespaceURI===Ye?t.createElement(e):t.createElementNS(n,e)}}function Ve(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function $e(e){var t=We(e);return(t.local?Ve:ze)(t)}function Ue(){}function Ze(e){return null==e?Ue:function(){return this.querySelector(e)}}function qe(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}function Ge(){return[]}function Ke(e){return function(t){return t.matches(e)}}var Je=Array.prototype.find;function Qe(){return this.firstElementChild}var et=Array.prototype.filter;function tt(){return this.children}function nt(e){return new Array(e.length)}function rt(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}function at(e,t,n,r,a,s){for(var o,i=0,l=t.length,c=s.length;i<c;++i)(o=t[i])?(o.__data__=s[i],r[i]=o):n[i]=new rt(e,s[i]);for(;i<l;++i)(o=t[i])&&(a[i]=o)}function st(e,t,n,r,a,s,o){var i,l,c,h=new Map,u=t.length,d=s.length,p=new Array(u);for(i=0;i<u;++i)(l=t[i])&&(p[i]=c=o.call(l,l.__data__,i,t)+"",h.has(c)?a[i]=l:h.set(c,l));for(i=0;i<d;++i)c=o.call(e,s[i],i,s)+"",(l=h.get(c))?(r[i]=l,l.__data__=s[i],h.delete(c)):n[i]=new rt(e,s[i]);for(i=0;i<u;++i)(l=t[i])&&h.get(p[i])===l&&(a[i]=l)}function ot(e){return e.__data__}function it(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function lt(e){return function(){this.removeAttribute(e)}}function ct(e){return function(){this.removeAttributeNS(e.space,e.local)}}function ht(e,t){return function(){this.setAttribute(e,t)}}function ut(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function dt(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}}function pt(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function mt(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function ft(e){return function(){this.style.removeProperty(e)}}function gt(e,t,n){return function(){this.style.setProperty(e,t,n)}}function vt(e,t,n){return function(){var r=t.apply(this,arguments);null==r?this.style.removeProperty(e):this.style.setProperty(e,r,n)}}function bt(e){return function(){delete this[e]}}function yt(e,t){return function(){this[e]=t}}function Ct(e,t){return function(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}}function wt(e){return e.trim().split(/^|\s+/)}function Pt(e){return e.classList||new Et(e)}function Et(e){this._node=e,this._names=wt(e.getAttribute("class")||"")}function St(e,t){for(var n=Pt(e),r=-1,a=t.length;++r<a;)n.add(t[r])}function xt(e,t){for(var n=Pt(e),r=-1,a=t.length;++r<a;)n.remove(t[r])}function Dt(e){return function(){St(this,e)}}function kt(e){return function(){xt(this,e)}}function At(e,t){return function(){(t.apply(this,arguments)?St:xt)(this,e)}}function Mt(){this.textContent=""}function Tt(e){return function(){this.textContent=e}}function It(e){return function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}}function _t(){this.innerHTML=""}function Ot(e){return function(){this.innerHTML=e}}function Nt(e){return function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}}function Ft(){this.nextSibling&&this.parentNode.appendChild(this)}function Rt(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Lt(){return null}function Ht(){var e=this.parentNode;e&&e.removeChild(this)}function jt(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Xt(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Yt(e){return function(){var t=this.__on;if(t){for(var n,r=0,a=-1,s=t.length;r<s;++r)n=t[r],e.type&&n.type!==e.type||n.name!==e.name?t[++a]=n:this.removeEventListener(n.type,n.listener,n.options);++a?t.length=a:delete this.__on}}}function Bt(e,t,n){return function(){var r,a=this.__on,s=function(e){return function(t){e.call(this,t,this.__data__)}}(t);if(a)for(var o=0,i=a.length;o<i;++o)if((r=a[o]).type===e.type&&r.name===e.name)return this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=s,r.options=n),void(r.value=t);this.addEventListener(e.type,s,n),r={type:e.type,name:e.name,value:t,listener:s,options:n},a?a.push(r):this.__on=[r]}}function Wt(e,t,n){var r=mt(e),a=r.CustomEvent;"function"==typeof a?a=new a(t,n):(a=r.document.createEvent("Event"),n?(a.initEvent(t,n.bubbles,n.cancelable),a.detail=n.detail):a.initEvent(t,!1,!1)),e.dispatchEvent(a)}function zt(e,t){return function(){return Wt(this,e,t)}}function Vt(e,t){return function(){return Wt(this,e,t.apply(this,arguments))}}rt.prototype={constructor:rt,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}},Et.prototype={add:function(e){this._names.indexOf(e)<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};var $t=[null];function Ut(e,t){this._groups=e,this._parents=t}function Zt(e){return"string"==typeof e?new Ut([[document.querySelector(e)]],[document.documentElement]):new Ut([[e]],$t)}function qt(e){let t;for(;t=e.sourceEvent;)e=t;return e}function Gt(e,t){if(e=qt(e),void 0===t&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=e.clientX,r.y=e.clientY,[(r=r.matrixTransform(t.getScreenCTM().inverse())).x,r.y]}if(t.getBoundingClientRect){var a=t.getBoundingClientRect();return[e.clientX-a.left-t.clientLeft,e.clientY-a.top-t.clientTop]}}return[e.pageX,e.pageY]}function Kt(e,t){return e.target&&(e=qt(e),void 0===t&&(t=e.currentTarget),e=e.touches||[e]),Array.from(e,e=>Gt(e,t))}Ut.prototype={constructor:Ut,select:function(e){"function"!=typeof e&&(e=Ze(e));for(var t=this._groups,n=t.length,r=new Array(n),a=0;a<n;++a)for(var s,o,i=t[a],l=i.length,c=r[a]=new Array(l),h=0;h<l;++h)(s=i[h])&&(o=e.call(s,s.__data__,h,i))&&("__data__"in s&&(o.__data__=s.__data__),c[h]=o);return new Ut(r,this._parents)},selectAll:function(e){e="function"==typeof e?function(e){return function(){var t=e.apply(this,arguments);return null==t?[]:qe(t)}}(e):function(e){return null==e?Ge:function(){return this.querySelectorAll(e)}}(e);for(var t=this._groups,n=t.length,r=[],a=[],s=0;s<n;++s)for(var o,i=t[s],l=i.length,c=0;c<l;++c)(o=i[c])&&(r.push(e.call(o,o.__data__,c,i)),a.push(o));return new Ut(r,a)},selectChild:function(e){return this.select(null==e?Qe:function(e){return function(){return Je.call(this.children,e)}}("function"==typeof e?e:Ke(e)))},selectChildren:function(e){return this.selectAll(null==e?tt:function(e){return function(){return et.call(this.children,e)}}("function"==typeof e?e:Ke(e)))},filter:function(e){"function"!=typeof e&&(e=function(e){return function(){return this.matches(e)}}(e));for(var t=this._groups,n=t.length,r=new Array(n),a=0;a<n;++a)for(var s,o=t[a],i=o.length,l=r[a]=[],c=0;c<i;++c)(s=o[c])&&e.call(s,s.__data__,c,o)&&l.push(s);return new Ut(r,this._parents)},data:function(e,t){if(!arguments.length)return Array.from(this,ot);var n,r=t?st:at,a=this._parents,s=this._groups;"function"!=typeof e&&(n=e,e=function(){return n});for(var o=s.length,i=new Array(o),l=new Array(o),c=new Array(o),h=0;h<o;++h){var u=a[h],d=s[h],p=d.length,m=qe(e.call(u,u&&u.__data__,h,a)),f=m.length,g=l[h]=new Array(f),v=i[h]=new Array(f);r(u,d,g,v,c[h]=new Array(p),m,t);for(var b,y,C=0,w=0;C<f;++C)if(b=g[C]){for(C>=w&&(w=C+1);!(y=v[w])&&++w<f;);b._next=y||null}}return(i=new Ut(i,a))._enter=l,i._exit=c,i},enter:function(){return new Ut(this._enter||this._groups.map(nt),this._parents)},exit:function(){return new Ut(this._exit||this._groups.map(nt),this._parents)},join:function(e,t,n){var r=this.enter(),a=this,s=this.exit();return r="function"==typeof e?e(r):r.append(e+""),null!=t&&(a=t(a)),null==n?s.remove():n(s),r&&a?r.merge(a).order():a},merge:function(e){if(!(e instanceof Ut))throw new Error("invalid merge");for(var t=this._groups,n=e._groups,r=t.length,a=n.length,s=Math.min(r,a),o=new Array(r),i=0;i<s;++i)for(var l,c=t[i],h=n[i],u=c.length,d=o[i]=new Array(u),p=0;p<u;++p)(l=c[p]||h[p])&&(d[p]=l);for(;i<r;++i)o[i]=t[i];return new Ut(o,this._parents)},selection:function(){return this},order:function(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var r,a=e[t],s=a.length-1,o=a[s];--s>=0;)(r=a[s])&&(o&&4^r.compareDocumentPosition(o)&&o.parentNode.insertBefore(r,o),o=r);return this},sort:function(e){function t(t,n){return t&&n?e(t.__data__,n.__data__):!t-!n}e||(e=it);for(var n=this._groups,r=n.length,a=new Array(r),s=0;s<r;++s){for(var o,i=n[s],l=i.length,c=a[s]=new Array(l),h=0;h<l;++h)(o=i[h])&&(c[h]=o);c.sort(t)}return new Ut(a,this._parents).order()},call:function(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],a=0,s=r.length;a<s;++a){var o=r[a];if(o)return o}return null},size:function(){let e=0;for(const t of this)++e;return e},empty:function(){return!this.node()},each:function(e){for(var t=this._groups,n=0,r=t.length;n<r;++n)for(var a,s=t[n],o=0,i=s.length;o<i;++o)(a=s[o])&&e.call(a,a.__data__,o,s);return this},attr:function(e,t){var n=We(e);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((null==t?n.local?ct:lt:"function"==typeof t?n.local?pt:dt:n.local?ut:ht)(n,t))},style:function(e,t,n){return arguments.length>1?this.each((null==t?ft:"function"==typeof t?vt:gt)(e,t,null==n?"":n)):function(e,t){return e.style.getPropertyValue(t)||mt(e).getComputedStyle(e,null).getPropertyValue(t)}(this.node(),e)},property:function(e,t){return arguments.length>1?this.each((null==t?bt:"function"==typeof t?Ct:yt)(e,t)):this.node()[e]},classed:function(e,t){var n=wt(e+"");if(arguments.length<2){for(var r=Pt(this.node()),a=-1,s=n.length;++a<s;)if(!r.contains(n[a]))return!1;return!0}return this.each(("function"==typeof t?At:t?Dt:kt)(n,t))},text:function(e){return arguments.length?this.each(null==e?Mt:("function"==typeof e?It:Tt)(e)):this.node().textContent},html:function(e){return arguments.length?this.each(null==e?_t:("function"==typeof e?Nt:Ot)(e)):this.node().innerHTML},raise:function(){return this.each(Ft)},lower:function(){return this.each(Rt)},append:function(e){var t="function"==typeof e?e:$e(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})},insert:function(e,t){var n="function"==typeof e?e:$e(e),r=null==t?Lt:"function"==typeof t?t:Ze(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})},remove:function(){return this.each(Ht)},clone:function(e){return this.select(e?Xt:jt)},datum:function(e){return arguments.length?this.property("__data__",e):this.node().__data__},on:function(e,t,n){var r,a,s=function(e){return e.trim().split(/^|\s+/).map(function(e){var t="",n=e.indexOf(".");return n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),{type:e,name:t}})}(e+""),o=s.length;if(!(arguments.length<2)){for(i=t?Bt:Yt,r=0;r<o;++r)this.each(i(s[r],t,n));return this}var i=this.node().__on;if(i)for(var l,c=0,h=i.length;c<h;++c)for(r=0,l=i[c];r<o;++r)if((a=s[r]).type===l.type&&a.name===l.name)return l.value},dispatch:function(e,t){return this.each(("function"==typeof t?Vt:zt)(e,t))},[Symbol.iterator]:function*(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r,a=e[t],s=0,o=a.length;s<o;++s)(r=a[s])&&(yield r)}};var Jt=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n};class Qt extends e.Component{constructor(t){super(t),this.dx=0,this.dy=0,this.mouseInside=!1,this.mouseInteraction=!0,this.ref=e.createRef(),this.handleEnter=e=>{const{onMouseEnter:t}=this.props;if(void 0!==t){if(this.mouseInside=!0,!this.state.panInProgress&&!this.state.dragInProgress){Zt(J(this.ref.current)).on(te,this.handleMouseMove)}t(e)}},this.handleLeave=e=>{const{onMouseLeave:t}=this.props;if(void 0!==t){if(this.mouseInside=!1,!this.state.panInProgress&&!this.state.dragInProgress){Zt(J(this.ref.current)).on(te,null)}t(e)}},this.handleWheel=e=>{const{pan:t,onPan:n,zoom:r,onZoom:a}=this.props;if(!t&&!r)return;const{panInProgress:s}=this.state,o=Math.abs(e.deltaY)>Math.abs(e.deltaX)&&Math.abs(e.deltaY)>0,i=ue(e);if(e.preventDefault(),r&&this.focus&&o&&!s){const t=e.deltaY>0?1:-1;void 0!==a&&a(t,i,e)}else if(this.focus){if(this.shouldPan()&&void 0!==this.state.panStart){const{panStartXScale:t,chartsToPan:r}=this.state.panStart;this.lastNewPos=i,this.panHappened=!0,void 0===this.dx&&(this.dx=0),void 0===this.dy&&(this.dy=0),this.dx-=e.deltaX,this.dy+=e.deltaY;const a={dx:this.dx,dy:this.dy};void 0!==n&&n(i,t,a,r,e)}else{const{xScale:e,chartConfig:t}=this.props,n=He(t,i);this.dx=0,this.dy=0,this.setState({panInProgress:!0,panStart:{panStartXScale:e,panOrigin:i,chartsToPan:n}})}this.queuePanEnd(e)}},this.handleMouseMove=e=>{const{onMouseMove:t,mouseMove:n}=this.props;if(void 0!==t&&this.mouseInteraction&&n&&!this.state.panInProgress){t(Gt(e,this.ref.current),"mouse",e)}},this.handleClick=e=>{const t=ue(e),{onClick:n,onDoubleClick:r}=this.props;this.panHappened||this.dragHappened||(this.clicked&&void 0!==r?(r(t,e),this.clicked=!1):void 0!==n&&(n(t,e),this.clicked=!0,setTimeout(()=>{this.clicked&&(this.clicked=!1)},400)))},this.handleRightClick=e=>{e.stopPropagation(),e.preventDefault();const{onContextMenu:t,onPanEnd:n}=this.props,r=ue(e,this.ref.current.getBoundingClientRect());if(void 0!==this.state.panStart){const{panStartXScale:t,panOrigin:[a,s],chartsToPan:o}=this.state.panStart;this.panHappened&&void 0!==n&&n(r,t,{dx:a,dy:s},o,e);Zt(J(this.ref.current)).on(te,null).on(ne,null),this.setState({panInProgress:!1,panStart:void 0})}void 0!==t&&t(r,e)},this.handleDrag=e=>{const{onDrag:t}=this.props;if(void 0===t)return;this.dragHappened=!0;const{dragStartPosition:n}=this.state;if(void 0===n)return;t({startPos:n,mouseXY:Gt(e,this.ref.current)},e)},this.handleDragEnd=e=>{const t=Gt(e,this.ref.current);if(Zt(J(this.ref.current)).on(te,this.mouseInside?this.handleMouseMove:null).on(ne,null),this.dragHappened){const{onDragComplete:n}=this.props;void 0!==n&&n({mouseXY:t},e)}this.setState({dragInProgress:!1}),this.mouseInteraction=!0},this.canPan=()=>{const{getAllPanConditions:e}=this.props,{pan:t}=this.props,{panEnabled:n,draggable:r}=e().reduce((e,t)=>({draggable:e.draggable||t.draggable,panEnabled:e.panEnabled&&t.panEnabled}),{draggable:!1,panEnabled:t});return{panEnabled:n,somethingSelected:r}},this.handleMouseDown=e=>{if(0!==e.button)return;const{xScale:t,chartConfig:n,onMouseDown:r}=this.props;if(this.panHappened=!1,this.dragHappened=!1,this.focus=!0,!this.state.panInProgress&&this.mouseInteraction){const a=ue(e),s=He(n,a),{panEnabled:o,somethingSelected:i}=this.canPan(),l=o&&!i;if(l){this.setState({panInProgress:l,panStart:{panStartXScale:t,panOrigin:a,chartsToPan:s}});Zt(J(this.ref.current)).on(te,this.handlePan).on(ne,this.handlePanEnd)}else if(i){this.setState({panInProgress:!1,dragInProgress:!0,panStart:void 0,dragStartPosition:a});const{onDragStart:t}=this.props;void 0!==t&&t({startPos:a},e);Zt(J(this.ref.current)).on(te,this.handleDrag).on(ne,this.handleDragEnd)}void 0!==r&&r(a,s,e)}e.preventDefault()},this.shouldPan=()=>{const{pan:e,onPan:t}=this.props;return e&&t&&void 0!==this.state.panStart},this.handlePan=e=>{if(this.shouldPan()&&void 0!==this.state.panStart){this.panHappened=!0;const{panStartXScale:t,panOrigin:n,chartsToPan:r}=this.state.panStart;let a,s,o;this.mouseInteraction?(o=Gt(e,this.ref.current),this.lastNewPos=o,a=o[0]-n[0],s=o[1]-n[1]):(o=Kt(e,this.ref.current)[0],this.lastNewPos=o,a=n[0]-o[0],s=n[1]-o[1]),this.dx=a,this.dy=s;const{onPan:i}=this.props;void 0!==i&&i(o,t,{dx:a,dy:s},r,e)}},this.handlePanEnd=e=>{const{pan:t,onPanEnd:n}=this.props;if(void 0!==this.state.panStart){const{panStartXScale:r,chartsToPan:a}=this.state.panStart;if(Zt(J(this.ref.current)).on(te,this.mouseInside?this.handleMouseMove:null).on(ne,null).on(re,null).on(ae,null),this.panHappened&&t&&n){const{dx:t=0,dy:s=0}=this;delete this.dx,delete this.dy,void 0!==this.lastNewPos&&n(this.lastNewPos,r,{dx:t,dy:s},a,e)}this.setState({panInProgress:!1,panStart:void 0})}},this.handleTouchMove=e=>{const{onMouseMove:t}=this.props;if(void 0===t)return;t(he(se(e.touches[0]),e),"touch",e)},this.handleTouchStart=e=>{this.mouseInteraction=!1;const{pan:t,chartConfig:n,onMouseMove:r,xScale:a,onPanEnd:s}=this.props;if(1===e.touches.length){this.panHappened=!1;const s=he(se(e.touches[0]),e);if(void 0!==r&&r(s,"touch",e),t){const e=He(n,s);this.setState({panInProgress:!0,panStart:{panStartXScale:a,panOrigin:s,chartsToPan:e}});Zt(J(this.ref.current)).on(re,this.handlePan,!1).on(ae,this.handlePanEnd,!1)}}else if(2===e.touches.length){const{panInProgress:n,panStart:r}=this.state;if(n&&t&&s&&void 0!==r){const{panStartXScale:n,panOrigin:[o,i],chartsToPan:l}=r;Zt(J(this.ref.current)).on(te,this.mouseInside?this.handleMouseMove:null).on(ne,null).on(re,this.handlePinchZoom,!1).on(ae,this.handlePinchZoomEnd,!1);const c=he(se(e.touches[0]),e),h=he(se(e.touches[1]),e);this.panHappened&&t&&s&&void 0!==this.lastNewPos&&s(this.lastNewPos,n,{dx:o,dy:i},l,e),this.setState({panInProgress:!1,pinchZoomStart:{xScale:a,touch1Pos:c,touch2Pos:h,range:a.range(),chartsToPan:l}})}}},this.handlePinchZoom=e=>{const{pinchZoomStart:t}=this.state;if(void 0===t)return;const{xScale:n,zoom:r,onPinchZoom:a}=this.props;if(!r||void 0===a)return;const[s,o]=Kt(this.ref.current),{chartsToPan:i}=t;a(Jt(t,["chartsToPan"]),{touch1Pos:s,touch2Pos:o,xScale:n},e)},this.handlePinchZoomEnd=e=>{Zt(J(this.ref.current)).on(re,null).on(ae,null);const{pinchZoomStart:t}=this.state;if(void 0===t)return;const{chartsToPan:n}=t,r=Jt(t,["chartsToPan"]),{zoom:a,onPinchZoomEnd:s}=this.props;a&&s&&s(r,e),this.setState({pinchZoomStart:void 0})},this.setCursorClass=e=>{e!==this.state.cursorOverrideClass&&this.setState({cursorOverrideClass:null===e?void 0:e})},this.focus=t.focus,this.state={panInProgress:!1}}componentDidMount(){const{disableInteraction:e}=this.props,{current:t}=this.ref;null!==t&&(e||(Zt(t).on(Q,this.handleEnter).on(ee,this.handleLeave),t.addEventListener("wheel",this.handleWheel,{passive:!1})))}componentDidUpdate(){this.componentDidMount()}componentWillUnmount(){const{disableInteraction:e}=this.props,{current:t}=this.ref;if(null!==t&&!e){Zt(t).on(Q,null).on(ee,null);Zt(J(t)).on(te,null),t.removeEventListener("wheel",this.handleWheel,{passive:!1})}}queuePanEnd(e){void 0!==this.panEndTimeout&&window.clearTimeout(this.panEndTimeout),this.panEndTimeout=window.setTimeout(()=>{this.handlePanEnd(e)},100)}cancelDrag(){Zt(J(this.ref.current)).on(te,this.mouseInside?this.handleMouseMove:null).on(ne,null),this.setState({dragInProgress:!1}),this.mouseInteraction=!0}render(){const{height:t,width:n,disableInteraction:r,useCrossHairStyleCursor:a}=this.props,s=r?void 0:void 0!==this.state.cursorOverrideClass?this.state.cursorOverrideClass:a?this.state.panInProgress?"react-financial-charts-grabbing-cursor":"react-financial-charts-crosshair-cursor":void 0,o=r?void 0:{onMouseDown:this.handleMouseDown,onClick:this.handleClick,onContextMenu:this.handleRightClick,onTouchStart:this.handleTouchStart,onTouchMove:this.handleTouchMove};return e.createElement("rect",Object.assign({ref:this.ref,className:s,width:n,height:t,style:{opacity:0}},o))}}Qt.defaultProps={mouseMove:!1,zoom:!1,pan:!1,panSpeedMultiplier:1,focus:!1,disableInteraction:!1};class en extends e.PureComponent{constructor(){super(...arguments),this.bgRef=e.createRef(),this.axesRef=e.createRef(),this.mouseRef=e.createRef()}getCanvasContexts(){var e,t,n,r,a,s;return{bg:null!==(t=null===(e=this.bgRef.current)||void 0===e?void 0:e.getContext("2d"))&&void 0!==t?t:void 0,axes:null!==(r=null===(n=this.axesRef.current)||void 0===n?void 0:n.getContext("2d"))&&void 0!==r?r:void 0,mouseCoord:null!==(s=null===(a=this.mouseRef.current)||void 0===a?void 0:a.getContext("2d"))&&void 0!==s?s:void 0}}render(){const{height:t,ratio:n,style:r,width:a}=this.props,s=a*n,o=t*n,i={position:"absolute",width:a,height:t};return e.createElement("div",{style:Object.assign(Object.assign({},r),{position:"absolute"})},e.createElement("canvas",{ref:this.bgRef,width:s,height:o,style:i}),e.createElement("canvas",{ref:this.axesRef,width:s,height:o,style:i}),e.createElement("canvas",{ref:this.mouseRef,width:s,height:o,style:i}))}}function tn(e,t,n,r){const{lastItem:a,lastItemX:s}=e,o=t(a),[i,l]=n.range();return(l-i)/(s.valueOf()-i)*(o.valueOf()-r.valueOf())+r.valueOf()}function nn(e,t,n,r,a){return{filterData:function(s,o,i,l,{currentPlotData:c,currentDomain:h,fallbackStart:u,fallbackEnd:d,ignoreThresholds:p=!1}={}){if(e)return{plotData:s,domain:o};let m=oe(o),f=ie(o),g=o,v=an(s,m,f,i);1===v.length&&void 0!==u&&(m=u,f=tn(d,i,l,m),g=[m,f],v=an(s,m,f,i)),"function"==typeof t?g=t(g,[i(oe(s)),i(ie(s))]):("left"!==t&&"both"!==t&&!0!==t||(g=[$([m,i(oe(s))]),g[1]]),"right"!==t&&"both"!==t&&!0!==t||(g=[g[0],U([f,i(ie(s))])])),g!==o&&(v=an(s,g[0],g[1],i));const b=g,y=l.copy().domain(b);let C,w,P=Math.floor(y(i(ie(v)))-y(i(oe(v))));a&&P<0&&(P*=-1);const E=ie(y.range())-oe(y.range());if(p&&v.length>1||function(e,t,n,r){const a=function(e,t){return Math.max(1,Math.ceil(e*t))}(e,r),s=rn(e,n);return t>=a&&t<s}(P,v.length,n,r))C=v,w=b;else if(E>rn(P,n)&&le(d)){C=v;const e=tn(d,i,l,oe(b));w=[oe(b),e]}else C=null!=c?c:v.slice(v.length-function(e,t){return Math.floor(.97*rn(e,t))}(P,n)),w=null!=h?h:[i(oe(C)),i(ie(C))];return{plotData:C,domain:w}}}}function rn(e,t){return Math.floor(e*t)}function an(e,t,n,r){const a=q(e,t,r).left,s=q(e,n,r).right;return e.slice(a,s+1)}const sn=["seriesName"],on=()=>{},ln={amIOnTop:()=>!1,chartConfigs:[],chartId:0,ratio:0,displayXAccessor:()=>0,fullData:[],getMutableState:()=>({}),height:0,margin:{top:0,right:0,bottom:0,left:0},plotData:[],setCursorClass:on,subscribe:on,unsubscribe:on,redraw:on,width:0,xAccessor:()=>0,xScale:on},cn=e.createContext(ln),hn=e=>{const{margin:t,height:n,width:r}=e;return{height:n-t.top-t.bottom,width:r-t.left-t.right}},un=e=>e?-1:1,dn=e=>{const{data:t,plotFull:n,xScale:r,clamp:a,pointsPerPxThreshold:s,flipXScale:o,xAccessor:i,displayXAccessor:l,minPointsPerPxThreshold:c}=e,h=void 0!==n?n:i===Z,{filterData:u}=function({xScale:e,useWholeData:t,clamp:n,pointsPerPxThreshold:r,minPointsPerPxThreshold:a,flipXScale:s}){return nn(t||ce(e.invert),n,r,a,s)}({xScale:r,useWholeData:h,clamp:a,pointsPerPxThreshold:s,minPointsPerPxThreshold:c,flipXScale:o});return{xAccessor:i,displayXAccessor:null!=l?l:i,xScale:r.copy(),fullData:t,filterData:u}},pn=e=>{const t=mn(e),{xAccessor:n,displayXAccessor:r,fullData:a,plotData:s,xScale:o}=t,{postCalculator:i,children:l}=e,c=void 0!==i?i(s):s,h=je(Le(hn(e),l),{plotData:c,xAccessor:n,displayXAccessor:r,fullData:a},o.domain());return Object.assign(Object.assign({},t),{xScale:o,plotData:c,chartConfigs:h})},mn=e=>{const{xAccessor:t,xExtents:n,data:r,padding:a,flipXScale:s}=e,o=un(s),i=hn(e),l="function"==typeof n?n(r):V(n.map(e=>K(e)).map(e=>e(r,t))),{xAccessor:c,displayXAccessor:h,xScale:u,fullData:d,filterData:p}=dn(e),m=fn(u,i,a,o),{plotData:f,domain:g}=p(d,l,t,m);return{plotData:f,xScale:m.domain(g),xAccessor:c,displayXAccessor:h,fullData:d,filterData:p}},fn=(e,t,n,r=1)=>{if(e.rangeRoundPoints){if(isNaN(n))throw new Error("padding has to be a number for ordinal scale");e.rangeRoundPoints([0,t.width],n)}else if(e.padding){if(isNaN(n))throw new Error("padding has to be a number for ordinal scale");e.range([0,t.width]),e.padding(n/2)}else{const{left:a,right:s}=isNaN(n)?n:{left:n,right:n};r>0?e.range([a,t.width-s]):e.range([t.width-s,a])}return e},gn=e=>{const{touch1Pos:t,touch2Pos:n}=e;return{topLeft:[Math.min(t[0],n[0]),Math.min(t[1],n[1])],bottomRight:[Math.max(t[0],n[0]),Math.max(t[1],n[1])]}},vn=(e,t,n)=>!isNaN(e(t(oe(n))))&&le(e.invert);class bn extends e.Component{constructor(t){super(t),this.canvasContainerRef=e.createRef(),this.eventCaptureRef=e.createRef(),this.lastSubscriptionId=0,this.mutableState={mouseXY:[0,0],currentCharts:[],currentItem:null},this.panInProgress=!1,this.subscriptions=[],this.getMutableState=()=>this.mutableState,this.getCanvasContexts=()=>{var e;return null===(e=this.canvasContainerRef.current)||void 0===e?void 0:e.getCanvasContexts()},this.generateSubscriptionId=()=>(this.lastSubscriptionId++,this.lastSubscriptionId),this.subscribe=(e,t)=>{const{getPanConditions:n=K({draggable:!1,panEnabled:!0})}=t;this.subscriptions=this.subscriptions.concat(Object.assign(Object.assign({id:e},t),{getPanConditions:n}))},this.unsubscribe=e=>{this.subscriptions=this.subscriptions.filter(t=>t.id!==e)},this.getAllPanConditions=()=>this.subscriptions.map(e=>e.getPanConditions()),this.setCursorClass=e=>{var t;null===(t=this.eventCaptureRef.current)||void 0===t||t.setCursorClass(e)},this.amIOnTop=e=>{const t=this.subscriptions.filter(e=>e.getPanConditions().draggable);return t.length>0&&ie(t).id===e},this.handleContextMenu=(e,t)=>{const{xAccessor:n,chartConfigs:r,plotData:a,xScale:s}=this.state,o=He(r,e),i=Xe(s,n,e,a);this.triggerEvent("contextmenu",{mouseXY:e,currentItem:i,currentCharts:o},t)},this.calculateStateForDomain=e=>{const{xAccessor:t,displayXAccessor:n,xScale:r,chartConfigs:a,plotData:s}=this.state,{filterData:o,fullData:i}=this.state,{postCalculator:l=bn.defaultProps.postCalculator}=this.props,{plotData:c,domain:h}=o(i,e,t,r,{currentPlotData:s,currentDomain:r.domain()}),u=l(c),d=r.copy().domain(h),p=je(a,{plotData:u,xAccessor:t,displayXAccessor:n,fullData:i},d.domain());return{xScale:d,plotData:u,chartConfigs:p}},this.pinchZoomHelper=(e,t)=>{const{xScale:n}=e,{xScale:r,chartConfigs:a,plotData:s,xAccessor:o,displayXAccessor:i,filterData:l,fullData:c}=this.state,{postCalculator:h=bn.defaultProps.postCalculator}=this.props,{topLeft:u,bottomRight:d}=gn(e),{topLeft:p,bottomRight:m}=gn(t),f=n.range()[1],g=Math.round(-(d[0]*p[0]-u[0]*m[0])/(u[0]-d[0])),v=Math.round(f+((f-d[0])*(f-p[0])-(f-u[0])*(f-m[0]))/(f-u[0]-(f-d[0]))),b=[Math.round(-g*u[0]/(-g+p[0])),Math.round(f-(v-f)*(f-u[0])/(v+(f-p[0])))].map(n.invert),{plotData:y,domain:C}=l(c,b,o,n,{currentPlotData:s,currentDomain:r.domain()}),w=h(y),P=r.copy().domain(C),E=t.touch1Pos;return{chartConfigs:je(a,{plotData:w,xAccessor:o,displayXAccessor:i,fullData:c},P.domain()),xScale:P,plotData:w,mouseXY:E,currentItem:Xe(P,o,E,w),xAccessor:o,fullData:c}},this.handlePinchZoom=(e,t,n)=>{if(!this.waitingForPinchZoomAnimationFrame){this.waitingForPinchZoomAnimationFrame=!0;const r=this.pinchZoomHelper(e,t);this.triggerEvent("pinchzoom",r,n),this.finalPinch=t,requestAnimationFrame(()=>{this.clearBothCanvas(),this.draw({trigger:"pinchzoom"}),this.waitingForPinchZoomAnimationFrame=!1})}},this.handlePinchZoomEnd=(e,t)=>{const{xAccessor:n=bn.defaultProps.xAccessor}=this.state;if(this.finalPinch){const r=this.pinchZoomHelper(e,this.finalPinch),{xScale:a,fullData:s}=r;this.triggerEvent("pinchzoom",r,t),this.finalPinch=void 0,this.clearThreeCanvas();const o=oe(s),i=oe(a.domain()),l=n(o),c=ie(s),h=ie(a.domain()),u=n(c),{onLoadAfter:d,onLoadBefore:p}=this.props;this.setState(r,()=>{i<l&&void 0!==p&&p(i,l),u<h&&void 0!==d&&d(u,h)})}},this.handleZoom=(e,t,n)=>{if(this.panInProgress)return;const{xAccessor:r,xScale:a,plotData:s,fullData:o}=this.state,{zoomMultiplier:i=bn.defaultProps.zoomMultiplier,zoomAnchor:l=bn.defaultProps.zoomAnchor}=this.props,c=l({xScale:a,xAccessor:r,mouseXY:t,plotData:s}),h=a(c),u=e>0?1*i:1/i,d=a.range().map(e=>h+(e-h)*u).map(e=>a.invert(e)),{xScale:p,plotData:m,chartConfigs:f}=this.calculateStateForDomain(d),g=Xe(p,r,t,m),v=He(f,t);this.clearThreeCanvas();const b=oe(o),y=oe(p.domain()),C=r(b),w=ie(o),P=ie(p.domain()),E=r(w);this.mutableState={mouseXY:t,currentItem:g,currentCharts:v},this.triggerEvent("zoom",{xScale:p,plotData:m,chartConfigs:f,mouseXY:t,currentCharts:v,currentItem:g,show:!0},n);const{onLoadAfter:S,onLoadBefore:x}=this.props;this.setState({xScale:p,plotData:m,chartConfigs:f},()=>{y<C&&void 0!==x&&x(y,C),E<P&&void 0!==S&&S(E,P)})},this.xAxisZoom=e=>{const{xScale:t,plotData:n,chartConfigs:r}=this.calculateStateForDomain(e);this.clearThreeCanvas();const{xAccessor:a,fullData:s}=this.state,o=oe(s),i=oe(t.domain()),l=a(o),c=ie(s),h=ie(t.domain()),u=a(c),{onLoadAfter:d,onLoadBefore:p}=this.props;this.setState({xScale:t,plotData:n,chartConfigs:r},()=>{i<l&&void 0!==p&&p(i,l),u<h&&void 0!==d&&d(u,h)})},this.yAxisZoom=(e,t)=>{this.clearThreeCanvas();const{chartConfigs:n}=this.state,r=n.map(n=>{if(n.id===e){const{yScale:e}=n;return Object.assign(Object.assign({},n),{yScale:e.copy().domain(t),yPanEnabled:!0})}return n});this.setState({chartConfigs:r})},this.draw=e=>{this.subscriptions.forEach(t=>{le(t.draw)&&t.draw(e)})},this.redraw=()=>{this.clearThreeCanvas(),this.draw({force:!0})},this.panHelper=(e,t,{dx:n,dy:r},a)=>{const{xAccessor:s,displayXAccessor:o,chartConfigs:i,filterData:l,fullData:c}=this.state,{postCalculator:h=bn.defaultProps.postCalculator}=this.props,u=t.range().map(e=>e-n).map(e=>t.invert(e)),{plotData:d,domain:p}=l(c,u,s,t,{currentPlotData:this.hackyWayToStopPanBeyondBounds__plotData,currentDomain:this.hackyWayToStopPanBeyondBounds__domain,ignoreThresholds:!0}),m=t.copy().domain(p),f=h(d),g=Xe(m,s,e,f),v=je(i,{plotData:f,xAccessor:s,displayXAccessor:o,fullData:c},m.domain(),r,a);return{xScale:m,plotData:f,chartConfigs:v,mouseXY:e,currentCharts:He(v,e),currentItem:g}},this.handlePan=(e,t,n,r,a)=>{var s,o;if(this.waitingForPanAnimationFrame)return;this.waitingForPanAnimationFrame=!0,this.hackyWayToStopPanBeyondBounds__plotData=null!==(s=this.hackyWayToStopPanBeyondBounds__plotData)&&void 0!==s?s:this.state.plotData,this.hackyWayToStopPanBeyondBounds__domain=null!==(o=this.hackyWayToStopPanBeyondBounds__domain)&&void 0!==o?o:this.state.xScale.domain();const i=this.panHelper(e,t,n,r);this.hackyWayToStopPanBeyondBounds__plotData=i.plotData,this.hackyWayToStopPanBeyondBounds__domain=i.xScale.domain(),this.panInProgress=!0,this.triggerEvent("pan",i,a),this.mutableState={mouseXY:i.mouseXY,currentItem:i.currentItem,currentCharts:i.currentCharts},requestAnimationFrame(()=>{this.waitingForPanAnimationFrame=!1,this.clearBothCanvas(),this.draw({trigger:"pan"})})},this.handlePanEnd=(e,t,n,r,a)=>{const s=this.panHelper(e,t,n,r);this.hackyWayToStopPanBeyondBounds__plotData=null,this.hackyWayToStopPanBeyondBounds__domain=null,this.panInProgress=!1;const{xScale:o,plotData:i,chartConfigs:l}=s;this.triggerEvent("panend",s,a),requestAnimationFrame(()=>{const{xAccessor:e,fullData:t}=this.state,n=oe(t),r=oe(o.domain()),a=e(n),s=ie(t),c=ie(o.domain()),h=e(s),{onLoadAfter:u,onLoadBefore:d}=this.props;this.clearThreeCanvas(),this.setState({xScale:o,plotData:i,chartConfigs:l},()=>{r<a&&void 0!==d&&d(r,a),h<c&&void 0!==u&&u(h,c)})})},this.handleMouseDown=(e,t,n)=>{this.triggerEvent("mousedown",this.mutableState,n)},this.handleMouseEnter=e=>{this.triggerEvent("mouseenter",{show:!0},e)},this.handleMouseMove=(e,t,n)=>{if(this.waitingForMouseMoveAnimationFrame)return;this.waitingForMouseMoveAnimationFrame=!0;const{chartConfigs:r,plotData:a,xScale:s,xAccessor:o}=this.state,i=He(r,e),l=Xe(s,o,e,a);this.triggerEvent("mousemove",{show:!0,mouseXY:e,prevMouseXY:this.prevMouseXY,currentItem:l,currentCharts:i},n),this.prevMouseXY=e,this.mutableState={mouseXY:e,currentItem:l,currentCharts:i},requestAnimationFrame(()=>{this.clearMouseCanvas(),this.draw({trigger:"mousemove"}),this.waitingForMouseMoveAnimationFrame=!1})},this.handleMouseLeave=e=>{this.triggerEvent("mouseleave",{show:!1},e),this.clearMouseCanvas(),this.draw({trigger:"mouseleave"})},this.handleDragStart=({startPos:e},t)=>{this.triggerEvent("dragstart",{startPos:e},t)},this.handleDrag=({startPos:e,mouseXY:t},n)=>{const{chartConfigs:r,plotData:a,xScale:s,xAccessor:o}=this.state,i=He(r,t),l=Xe(s,o,t,a);this.triggerEvent("drag",{startPos:e,mouseXY:t,currentItem:l,currentCharts:i},n),this.mutableState={mouseXY:t,currentItem:l,currentCharts:i},requestAnimationFrame(()=>{this.clearMouseCanvas(),this.draw({trigger:"drag"})})},this.handleDragEnd=({mouseXY:e},t)=>{this.triggerEvent("dragend",{mouseXY:e},t),requestAnimationFrame(()=>{this.clearMouseCanvas(),this.draw({trigger:"dragend"})})},this.handleClick=(e,t)=>{this.triggerEvent("click",this.mutableState,t),requestAnimationFrame(()=>{this.clearMouseCanvas(),this.draw({trigger:"click"})})},this.handleDoubleClick=(e,t)=>{this.triggerEvent("dblclick",{},t)},this.resetYDomain=e=>{const{chartConfigs:t}=this.state;let n=!1;const r=t.map(t=>!ce(e)&&t.id!==e||G(t.yScale.domain(),t.realYDomain)?t:(n=!0,Object.assign(Object.assign({},t),{yScale:t.yScale.domain(t.realYDomain),yPanEnabled:!1})));n&&(this.clearThreeCanvas(),this.setState({chartConfigs:r}))},this.state=pn(t)}static getDerivedStateFromProps(e,t){var n;const{chartConfigs:r,plotData:a,xAccessor:s,xScale:o}=t,i=vn(o,s,a),l=(c=t.lastProps||{},h=e,!sn.every(e=>G(c[e],h[e])));var c,h;let u;if(i&&!l&&G(null===(n=t.lastProps)||void 0===n?void 0:n.xExtents,e.xExtents)){const[n,a]=o.domain(),s=ie(t.fullData),i=dn(e),{xAccessor:l}=i,c=l(s);u=((e,t,n,r,a)=>{const{fullData:s,xScale:o,xAccessor:i,displayXAccessor:l,filterData:c}=e,h=ie(s),u=i(h),[d,p]=t.domain(),{postCalculator:m,children:f,padding:g,flipXScale:v,maintainPointsPerPixelOnResize:b}=n,y=un(v),C=hn(n),w=fn(o,C,g,y);let P;if(!r||p>=u){const[e,n]=t.range(),[r,a]=w.range(),o=(a-r)/(n-e)*(p.valueOf()-d.valueOf()),l=c(s,[b?p.valueOf()-o:d,p],i,w,{fallbackStart:d,fallbackEnd:{lastItem:h,lastItemX:t(u)}});P=l.plotData,w.domain(l.domain)}else if(r&&p<u){const e=t(u)-t.range()[1],[n,r]=t.range().map(t=>t+e).map(e=>t.invert(e)),a=c(s,[n,r],i,w);P=a.plotData,w.domain(a.domain)}const E=m(P),S=je(Le(C,f,a),{plotData:E,xAccessor:i,displayXAccessor:l,fullData:s},w.domain());return{xScale:w,xAccessor:i,chartConfigs:S,plotData:E,fullData:s,filterData:c}})(i,o,e,c<=a&&c>=n,r)}else u=pn(e);return Object.assign(Object.assign({},u),{lastProps:e,propIteration:(t.propIteration||0)+1})}getSnapshotBeforeUpdate(e,t){return t.propIteration===this.state.propIteration||this.panInProgress||this.clearThreeCanvas(),null}componentDidUpdate(e){e.data!==this.props.data&&this.triggerEvent("dataupdated",{chartConfigs:this.state.chartConfigs,xScale:this.state.xScale,plotData:this.state.plotData})}clearBothCanvas(){const e=this.getCanvasContexts();e&&e.axes&&e.mouseCoord&&de([e.axes,e.mouseCoord],this.props.ratio)}clearMouseCanvas(){const e=this.getCanvasContexts();e&&e.mouseCoord&&de([e.mouseCoord],this.props.ratio)}clearThreeCanvas(){const e=this.getCanvasContexts();e&&e.axes&&e.mouseCoord&&e.bg&&de([e.axes,e.mouseCoord,e.bg],this.props.ratio)}cancelDrag(){var e;null===(e=this.eventCaptureRef.current)||void 0===e||e.cancelDrag(),this.triggerEvent("dragcancel")}triggerEvent(e,t,n){this.subscriptions.forEach(r=>{const a=Object.assign(Object.assign({},this.state),{subscriptions:this.subscriptions});r.listener(e,t,a,n)})}getContextValues(){const e=hn(this.props);return{chartId:-1,fullData:this.state.fullData,plotData:this.state.plotData,width:e.width,height:e.height,chartConfigs:this.state.chartConfigs,xScale:this.state.xScale,xAccessor:this.state.xAccessor,displayXAccessor:this.state.displayXAccessor,margin:this.props.margin,ratio:this.props.ratio,xAxisZoom:this.xAxisZoom,yAxisZoom:this.yAxisZoom,getCanvasContexts:this.getCanvasContexts,redraw:this.redraw,subscribe:this.subscribe,unsubscribe:this.unsubscribe,generateSubscriptionId:this.generateSubscriptionId,getMutableState:this.getMutableState,amIOnTop:this.amIOnTop,setCursorClass:this.setCursorClass}}shouldComponentUpdate(){return!this.panInProgress}render(){const{disableInteraction:t,disablePan:n,disableZoom:r,useCrossHairStyleCursor:a,onClick:s,onDoubleClick:o,height:i,width:l,margin:c=bn.defaultProps.margin,className:h,zIndex:u=bn.defaultProps.zIndex,defaultFocus:d,ratio:p,mouseMoveEvent:m}=this.props,{plotData:f,xScale:g,xAccessor:v,chartConfigs:b}=this.state,y=hn(this.props),C=vn(g,v,f),w=a&&C,P=e.createElement("style",{type:"text/css"},"\n\t.react-financial-charts-grabbing-cursor {\n\t\tpointer-events: all;\n\t\tcursor: -moz-grabbing;\n\t\tcursor: -webkit-grabbing;\n\t\tcursor: grabbing;\n\t}\n\t.react-financial-charts-crosshair-cursor {\n\t\tpointer-events: all;\n\t\tcursor: crosshair;\n\t}\n\t.react-financial-charts-tooltip-hover {\n\t\tpointer-events: all;\n\t\tcursor: pointer;\n\t}\n\t.react-financial-charts-avoid-interaction {\n\t\tpointer-events: none;\n\t}\n\t.react-financial-charts-enable-interaction {\n\t\tpointer-events: all;\n\t}\n\t.react-financial-charts-tooltip {\n\t\tpointer-events: all;\n\t\tcursor: pointer;\n\t}\n\t.react-financial-charts-default-cursor {\n\t\tcursor: default;\n\t}\n\t.react-financial-charts-move-cursor {\n\t\tcursor: move;\n\t}\n\t.react-financial-charts-pointer-cursor {\n\t\tcursor: pointer;\n\t}\n\t.react-financial-charts-ns-resize-cursor {\n\t\tcursor: ns-resize;\n\t}\n\t.react-financial-charts-ew-resize-cursor {\n\t\tcursor: ew-resize;\n\t}");return e.createElement(cn.Provider,{value:this.getContextValues()},e.createElement("div",{style:{position:"relative",width:l,height:i},className:h,onClick:s,onDoubleClick:o},e.createElement(en,{ref:this.canvasContainerRef,ratio:p,width:l,height:i,style:{height:i,zIndex:u,width:l}}),e.createElement("svg",{className:h,width:l,height:i,style:{position:"absolute",zIndex:u+5}},P,e.createElement("defs",null,e.createElement("clipPath",{id:"chart-area-clip"},e.createElement("rect",{x:"0",y:"0",width:y.width,height:y.height})),b.map((t,n)=>e.createElement("clipPath",{key:n,id:`chart-area-clip-${t.id}`},e.createElement("rect",{x:"0",y:"0",width:t.width,height:t.height})))),e.createElement("g",{transform:`translate(${c.left+.5}, ${c.top+.5})`},e.createElement(Qt,{ref:this.eventCaptureRef,useCrossHairStyleCursor:w,mouseMove:m&&C,zoom:!r&&C,pan:!n&&C,width:y.width,height:y.height,chartConfig:b,xScale:g,xAccessor:v,focus:d,disableInteraction:t,getAllPanConditions:this.getAllPanConditions,onContextMenu:this.handleContextMenu,onClick:this.handleClick,onDoubleClick:this.handleDoubleClick,onMouseDown:this.handleMouseDown,onMouseMove:this.handleMouseMove,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,onDragStart:this.handleDragStart,onDrag:this.handleDrag,onDragComplete:this.handleDragEnd,onZoom:this.handleZoom,onPinchZoom:this.handlePinchZoom,onPinchZoomEnd:this.handlePinchZoomEnd,onPan:this.handlePan,onPanEnd:this.handlePanEnd}),e.createElement("g",{className:"react-financial-charts-avoid-interaction"},this.props.children)))))}}bn.defaultProps={clamp:!1,className:"react-financial-charts",defaultFocus:!0,disablePan:!1,disableInteraction:!1,disableZoom:!1,flipXScale:!1,maintainPointsPerPixelOnResize:!0,margin:{top:0,right:40,bottom:40,left:0},minPointsPerPxThreshold:.01,mouseMoveEvent:!0,postCalculator:Z,padding:0,pointsPerPxThreshold:2,useCrossHairStyleCursor:!0,xAccessor:Z,xExtents:[U,$],zIndex:1,zoomAnchor:e=>{const{xScale:t,xAccessor:n,mouseXY:r,plotData:a}=e;return n(Xe(t,n,r,a))},zoomMultiplier:1.1};const yn=e.createContext(Object.assign(Object.assign({},ln),{chartConfig:{},chartId:0}));e.memo(t=>{const{id:n=0,onContextMenu:r,onDoubleClick:a}=t,s=e.useContext(cn),{subscribe:o,unsubscribe:i,chartConfigs:l}=s,c=e.useCallback((e,t,s,o)=>{switch(e){case"contextmenu":{if(void 0===r)return;const{currentCharts:e}=t;e.indexOf(n)>-1&&r(o,t);break}case"dblclick":{if(void 0===a)return;const{currentCharts:e}=t;e.indexOf(n)>-1&&a(o,t);break}}},[r,a,n]);e.useEffect(()=>(o(`chart_${n}`,{listener:c}),()=>i(`chart_${n}`)),[o,i,n,c]);const h=l.find(({id:e})=>e===t.id),u=e.useMemo(()=>Object.assign(Object.assign({},s),{chartId:n,chartConfig:h}),[n,h,s]),{origin:[d,p]}=h;return e.createElement(yn.Provider,{value:u},e.createElement("g",{transform:`translate(${d}, ${p})`,id:`chart_${n}`},t.children))}).displayName="Chart";const Cn={mouseleave:"mousemove",panend:"pan",pinchzoom:"pan",mousedown:"mousemove",click:"mousemove",contextmenu:"mousemove",dblclick:"mousemove",dragstart:"drag",dragend:"drag",dragcancel:"drag",zoom:"zoom"};class wn extends e.Component{constructor(e,t){super(e,t),this.moreProps={},this.dragInProgress=!1,this.evaluationInProgress=!1,this.iSetTheCursorClass=!1,this.listener=(e,t,n,r)=>{void 0!==t&&this.updateMoreProps(t),this.evaluationInProgress=!0,this.evaluateType(e,r),this.evaluationInProgress=!1},this.drawOnCanvas=this.drawOnCanvas.bind(this),this.getMoreProps=this.getMoreProps.bind(this),this.draw=this.draw.bind(this),this.updateMoreProps=this.updateMoreProps.bind(this),this.evaluateType=this.evaluateType.bind(this),this.isHover=this.isHover.bind(this),this.preCanvasDraw=this.preCanvasDraw.bind(this),this.postCanvasDraw=this.postCanvasDraw.bind(this),this.getPanConditions=this.getPanConditions.bind(this),this.shouldTypeProceed=this.shouldTypeProceed.bind(this),this.preEvaluate=this.preEvaluate.bind(this);const{generateSubscriptionId:n}=t;this.subscriberId=n(),this.state={updateCount:0}}updateMoreProps(e){Object.keys(e).forEach(t=>{this.moreProps[t]=e[t]})}shouldTypeProceed(e,t){return!0}preEvaluate(e,t,n){}evaluateType(e,t){const n=Cn[e]||e;if(this.props.drawOn.indexOf(n)>-1&&(this.preEvaluate(e,this.moreProps,t),this.shouldTypeProceed(e,this.moreProps)))switch(e){case"zoom":case"mouseenter":break;case"mouseleave":this.moreProps.hovering=!1,this.props.onUnHover&&this.props.onUnHover(t,this.getMoreProps());break;case"contextmenu":this.props.onContextMenu&&this.props.onContextMenu(t,this.getMoreProps()),this.moreProps.hovering&&this.props.onContextMenuWhenHover&&this.props.onContextMenuWhenHover(t,this.getMoreProps());break;case"mousedown":this.props.onMouseDown&&this.props.onMouseDown(t,this.getMoreProps());break;case"click":{const{onClick:e,onClickOutside:n,onClickWhenHover:r}=this.props,a=this.getMoreProps();a.hovering&&void 0!==r?r(t,a):void 0!==n&&n(t,a),void 0!==e&&e(t,a);break}case"mousemove":{const e=this.moreProps.hovering;this.moreProps.hovering=this.isHover(t);const{amIOnTop:n,setCursorClass:r}=this.context;this.moreProps.hovering&&!this.props.selected&&n(this.subscriberId)&&void 0!==this.props.onHover?(r("react-financial-charts-pointer-cursor"),this.iSetTheCursorClass=!0):this.moreProps.hovering&&this.props.selected&&n(this.subscriberId)?(r(this.props.interactiveCursorClass),this.iSetTheCursorClass=!0):e&&!this.moreProps.hovering&&this.iSetTheCursorClass&&(this.iSetTheCursorClass=!1,r(null));const a=this.getMoreProps();this.moreProps.hovering&&!e&&this.props.onHover&&this.props.onHover(t,a),e&&!this.moreProps.hovering&&this.props.onUnHover&&this.props.onUnHover(t,a),this.props.onMouseMove&&this.props.onMouseMove(t,a);break}case"dblclick":{const e=this.getMoreProps();this.props.onDoubleClick&&this.props.onDoubleClick(t,e),this.moreProps.hovering&&this.props.onDoubleClickWhenHover&&this.props.onDoubleClickWhenHover(t,e);break}case"pan":this.moreProps.hovering=!1,this.props.onPan&&this.props.onPan(t,this.getMoreProps());break;case"panend":this.props.onPanEnd&&this.props.onPanEnd(t,this.getMoreProps());break;case"dragstart":if(this.getPanConditions().draggable){const{amIOnTop:e}=this.context;e(this.subscriberId)&&(this.dragInProgress=!0,void 0!==this.props.onDragStart&&this.props.onDragStart(t,this.getMoreProps()))}break;case"drag":this.dragInProgress&&this.props.onDrag&&this.props.onDrag(t,this.getMoreProps());break;case"dragend":this.dragInProgress&&this.props.onDragComplete&&this.props.onDragComplete(t,this.getMoreProps()),this.dragInProgress=!1;break;case"dragcancel":if(this.dragInProgress||this.iSetTheCursorClass){const{setCursorClass:e}=this.context;e(null)}}}isHover(e){const{isHover:t}=this.props;return void 0!==t&&t(this.getMoreProps(),e)}getPanConditions(){return{draggable:!(!this.props.selected||!this.moreProps.hovering)||this.props.enableDragOnHover&&this.moreProps.hovering,panEnabled:!this.props.disablePan}}draw({trigger:e,force:t=!1}){const n=Cn[e]||e;if(this.props.drawOn.indexOf(n)>-1||this.props.selected||t){const{canvasDraw:e}=this.props;if(void 0===e){const{updateCount:e}=this.state;this.setState({updateCount:e+1})}else this.drawOnCanvas()}}UNSAFE_componentWillMount(){const{subscribe:e,chartId:t}=this.context,{clip:n,edgeClip:r}=this.props;e(this.subscriberId,{chartId:t,clip:n,edgeClip:r,listener:this.listener,draw:this.draw,getPanConditions:this.getPanConditions}),this.UNSAFE_componentWillReceiveProps(this.props,this.context)}componentWillUnmount(){const{unsubscribe:e}=this.context;if(e(this.subscriberId),this.iSetTheCursorClass){const{setCursorClass:e}=this.context;e(null)}}componentDidMount(){this.componentDidUpdate(this.props)}componentDidUpdate(e){const{canvasDraw:t,selected:n,interactiveCursorClass:r}=this.props;if(e.selected!==n){const{setCursorClass:e}=this.context;n&&this.moreProps.hovering?(this.iSetTheCursorClass=!0,e(r)):(this.iSetTheCursorClass=!1,e(null))}void 0===t||this.evaluationInProgress||(this.updateMoreProps(this.moreProps),this.drawOnCanvas())}UNSAFE_componentWillReceiveProps(e,t){const{xScale:n,plotData:r,chartConfig:a,getMutableState:s}=t;this.moreProps=Object.assign(Object.assign(Object.assign({},this.moreProps),s()),{xScale:n,plotData:r,chartConfig:a})}getMoreProps(){const{xScale:e,plotData:t,chartConfigs:n,morePropsDecorator:r,xAccessor:a,displayXAccessor:s,width:o,height:i}=this.context,{chartId:l,fullData:c}=this.context,h=Object.assign({xScale:e,plotData:t,chartConfigs:n,xAccessor:a,displayXAccessor:s,width:o,height:i,chartId:l,fullData:c},this.moreProps);return(r||Z)(h)}preCanvasDraw(e,t){}postCanvasDraw(e,t){}drawOnCanvas(){const{canvasDraw:e,canvasToDraw:t}=this.props;if(void 0===e||void 0===t)return;const{getCanvasContexts:n}=this.context,r=this.getMoreProps(),a=t(n());void 0!==a&&(this.preCanvasDraw(a,r),e(a,r),this.postCanvasDraw(a,r))}render(){const{canvasDraw:t,clip:n,svgDraw:r}=this.props;if(void 0!==t||void 0===r)return null;const{chartId:a}=this.context,s=n?{clipPath:`url(#chart-area-clip${void 0!==a?"-"+a:""})`}:void 0;return e.createElement("g",{style:s},r(this.getMoreProps()))}}wn.defaultProps={svgDraw:K(null),draw:[],canvasToDraw:e=>e.mouseCoord,clip:!0,edgeClip:!1,selected:!1,disablePan:!1,enableDragOnHover:!1},wn.contextType=cn;const Pn=["drag","dragend"];class En extends wn{constructor(e,t){super(e,t),this.preCanvasDraw=this.preCanvasDraw.bind(this),this.postCanvasDraw=this.postCanvasDraw.bind(this),this.shouldTypeProceed=this.shouldTypeProceed.bind(this),this.preEvaluate=this.preEvaluate.bind(this),this.updateMoreProps=this.updateMoreProps.bind(this)}preCanvasDraw(e,t){super.preCanvasDraw(e,t),e.save();const{margin:n,ratio:r}=this.context,{chartConfig:{width:a,height:s,origin:o}}=t,i=.5*r+o[0]+n.left,l=.5*r+o[1]+n.top,{clip:c,edgeClip:h}=this.props;e.setTransform(1,0,0,1,0,0),e.scale(r,r),h&&(e.beginPath(),e.rect(-1,l-10,a+n.left+n.right+1,s+20),e.clip()),e.translate(i,l),c&&(e.beginPath(),e.rect(-1,-1,a+1,s+1),e.clip())}postCanvasDraw(e,t){super.postCanvasDraw(e,t),e.restore()}updateMoreProps(e){super.updateMoreProps(e);const{chartConfig:t}=e;if(t&&Array.isArray(t)){const{chartId:e}=this.context,n=t.find(t=>t.id===e);this.moreProps.chartConfig=n}if(le(this.moreProps.chartConfig)){const{origin:[t,n]}=this.moreProps.chartConfig;if(le(e.mouseXY)){const{mouseXY:[r,a]}=e;this.moreProps.mouseXY=[r-t,a-n]}if(le(e.startPos)){const{startPos:[r,a]}=e;this.moreProps.startPos=[r-t,a-n]}}}preEvaluate(){}shouldTypeProceed(e,t){return!("mousemove"!==e&&"click"!==e||!this.props.disablePan)||(-1!==Pn.indexOf(e)||!le(t)||!le(t.currentCharts)||t.currentCharts.indexOf(this.context.chartId)>-1)}}En.defaultProps=wn.defaultProps,En.contextType=yn;var Sn=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n};class xn extends e.PureComponent{render(){const t=this.props,{children:n}=t,r=Sn(t,["children"]);return e.createElement("text",Object.assign({},r),n)}}xn.defaultProps={className:"react-financial-charts-tooltip",fontFamily:"-apple-system, system-ui, 'Helvetica Neue', Ubuntu, sans-serif",fontSize:11};var Dn=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n};class kn extends e.PureComponent{render(){const t=this.props,{children:n}=t,r=Dn(t,["children"]);return e.createElement("tspan",Object.assign({},r),n)}}kn.defaultProps={className:"react-financial-charts-tooltip-label",fill:"#4682B4"};class An extends n{constructor(){super(...arguments),this.renderSVG=this.renderSVG.bind(this)}renderSVG(e){const{accessor:n,changeFormat:r,className:a,displayTexts:s,displayValuesFor:o,fontFamily:i,fontSize:l,fontWeight:c,labelFill:h,labelFontWeight:u,ohlcFormat:d,onClick:p,origin:m,percentFormat:f,textFill:g,volumeFormat:v}=this.props,{chartConfig:{width:b,height:y},fullData:C}=e,w=o(this.props,e),P=null!=w?w:ie(C);let E=s.na,S=s.na,x=s.na,D=s.na,k=s.na,A=s.na;if(void 0!==P&&void 0!==n){const e=n(P);void 0!==e&&(E=d(e.open),S=d(e.high),x=d(e.low),D=d(e.close),k=`${r(e.close-e.open)} (${f((e.close-e.open)/e.open)})`,A=v(e.volume))}const[M,T]=K(m)(b,y),I=K(g)(P);return t.createElement("g",{className:a,transform:`translate(${M}, ${T})`,onClick:p},t.createElement(xn,{x:0,y:0,fontFamily:i,fontSize:l,fontWeight:c},t.createElement(kn,{fill:h,fontWeight:u,key:"label_O"},s.o),t.createElement("tspan",{key:"value_O",fill:I},E),t.createElement(kn,{fill:h,fontWeight:u,key:"label_H"},s.h),t.createElement("tspan",{key:"value_H",fill:I},S),t.createElement(kn,{fill:h,fontWeight:u,key:"label_L"},s.l),t.createElement("tspan",{key:"value_L",fill:I},x),t.createElement(kn,{fill:h,fontWeight:u,key:"label_C"},s.c),t.createElement("tspan",{key:"value_C",fill:I},D),t.createElement("tspan",{key:"value_Change",fill:I},` ${k}`),t.createElement(kn,{fill:h,fontWeight:u,key:"label_V"},s.v),t.createElement("tspan",{key:"value_V",fill:I},A)))}render(){return t.createElement(En,{clip:!1,svgDraw:this.renderSVG,drawOn:["mousemove"]})}}An.propTypes={accessor:l.func,changeFormat:l.func,className:l.string,displayTexts:l.object,displayValuesFor:l.func,fontFamily:l.string,fontSize:l.string,fontWeight:l.number,labelFill:l.string,labelFontWeight:l.number,ohlcFormat:l.func,onClick:l.func,origin:l.array,percentFormat:l.func,textFill:l.func,volumeFormat:l.func},An.defaultProps={accessor:e=>e,changeFormat:c("+.2f"),className:"react-financial-charts-tooltip-hover",displayTexts:{o:"O: ",h:" H: ",l:" L: ",c:" C: ",na:" n/a ",v:"   Vol: "},displayValuesFor:(e,t)=>t.currentItem,fontFamily:"-apple-system, system-ui, 'Helvetica Neue', Ubuntu, sans-serif",fontSize:"12px",fontWeight:300,labelFill:"#9EAAC7",labelFontWeight:300,ohlcFormat:c(".2f"),onClick:null,origin:[0,0],percentFormat:c("+.2%"),textFill:null,volumeFormat:c(".4s")};const Mn={strokeStyle:"#383E55",strokeWidth:2,tickLabelFill:"#9EAAC7",tickStrokeStyle:"#383E55",gridLinesStrokeStyle:"rgba(56, 62, 85, 0.5)"},Tn={fill:"#383E55",textFill:"#FFFFFF"},In={fill:"#383E55",fillOpacity:.75,strokeWidth:0,textFill:"#9EAAC7"},_n={strokeStyle:"#9EAAC7"},On=e=>e.close>e.open?"#26a69a":"#ef5350",Nn=e=>{let t,n,{plotData:r}=e;for(const{low:e,high:a}of r)void 0===t&&(t=e),void 0===n&&(n=a),void 0!==e&&t>e&&(t=e),void 0!==a&&n<a&&(n=a);void 0===t&&(t=0),void 0===n&&(n=0);const a=.1*(n-t);return[t-a,n+2*a]},Fn=t.memo(e=>{let{data:n,dateTimeFormat:s,height:o,margin:i,priceDisplayFormat:l,ratio:u,width:f,axisSettings:g={auto:!0,log:!1,percent:!1},chartType:W="candles"}=e;const[V,$]=r(0);if(!(n&&0!==n.length&&o&&u&&f))return null;const U=a(()=>{try{switch(W){case"heikinAshi":return C()(n);case"renko":return y().options({boxSize:1,sourcePath:"close"})(n);case"kagi":return b().options({reverseType:"ATR",windowSize:14,reverseValue:2})(n);case"pointFigure":try{const e=v().options({boxSize:1,reverseType:"fixed",reverseValue:3,sourcePath:"close"})(n);return console.log("P&F Data structure:",e?.slice(0,2)),e}catch(e){return console.warn("Point & Figure transformation failed:",e),n}default:return n}}catch(e){return console.warn("Data transformation failed for",W,e),n}},[n,W]),Z=h(s),q=w().inputDateAccessor(e=>e.date),{data:G,xScale:K,xAccessor:J,displayXAccessor:Q}=q(U),ee=a(()=>g.log?p():d(),[g.log]),te=a(()=>{if(g.percent&&G.length>0){const e=G[0].close;return t=>{let{plotData:n}=t,r=0,a=0;for(const t of n){const n=(t.close-e)/e*100;r>n&&(r=n),a<n&&(a=n)}const s=.1*Math.abs(a-r);return[r-s,a+s]}}return Nn},[g.percent,G]),ne=a(()=>g.percent?c("+.2f"):l,[g.percent,l]),re=[J(G[Math.max(0,G.length-parseInt(f/5))]),J(G[G.length-1])+1],ae=(o-i.top-i.bottom)/5;return t.createElement(P,{height:o,ratio:u,width:f,margin:i,seriesName:`Chart ${V}`,data:G,xScale:K,xAccessor:J,displayXAccessor:Q,xExtents:re,zoomAnchor:E},t.createElement(S,{id:1,height:ae,origin:(e,t)=>[0,t-ae],yExtents:e=>e.volume},t.createElement(x,{fillStyle:e=>e.close>e.open?"rgba(38, 166, 154, 0.3)":"rgba(239, 83, 80, 0.3)",yAccessor:e=>e.volume})),t.createElement(S,{id:2,yExtentsCalculator:te,yScale:ee},t.createElement(D,z({},Mn,{showGridLines:!0})),t.createElement(k,z({displayFormat:Z},Tn)),t.createElement(A,z({},Mn,{showGridLines:!0,tickFormat:ne})),t.createElement(M,z({rectWidth:i.right,displayFormat:ne},Tn)),t.createElement(T,{itemType:"last",rectWidth:i.right,fill:On,lineStroke:On,displayFormat:ne,yAccessor:e=>e.close}),(()=>{switch(W){case"bars":return t.createElement(L,{stroke:On,strokeWidth:1});case"candles":default:return t.createElement(O,null);case"hollow":return t.createElement(O,{fill:e=>e.close>e.open?"transparent":On(e),stroke:On,candleStrokeWidth:1});case"volume":return t.createElement(O,{fill:e=>{const t=Math.max(...n.map(e=>e.volume)),r=Math.min(.8,Math.max(.1,e.volume/t));return`${e.close>e.open?"#26a69a":"#ef5350"}${Math.round(255*r).toString(16).padStart(2,"0")}`},stroke:On,candleStrokeWidth:.5});case"line":return t.createElement(B,{yAccessor:e=>e.close,strokeStyle:"#26a69a",strokeWidth:2});case"lineMarkers":return t.createElement(t.Fragment,null,t.createElement(B,{yAccessor:e=>e.close,strokeStyle:"#26a69a",strokeWidth:2}),t.createElement(H,{yAccessor:e=>e.close,marker:j,markerProps:{r:3,fillStyle:"#26a69a",strokeStyle:"#26a69a",strokeWidth:1}}));case"step":return t.createElement(B,{yAccessor:e=>e.close,strokeStyle:"#26a69a",strokeWidth:2,curve:m});case"area":return t.createElement(X,{yAccessor:e=>e.close,strokeStyle:"#26a69a",strokeWidth:2,fillStyle:"rgba(38, 166, 154, 0.2)"});case"hlcArea":return t.createElement(t.Fragment,null,t.createElement(Y,{yAccessor:e=>e.high,base:(e,t)=>e(t.low),fillStyle:"rgba(38, 166, 154, 0.1)"}),t.createElement(B,{yAccessor:e=>e.close,strokeStyle:"#26a69a",strokeWidth:2}));case"baseline":return t.createElement(X,{yAccessor:e=>e.close,baseAt:e=>e(n[0]?.close||0),strokeStyle:e=>e.close>=n[0]?.close?"#26a69a":"#ef5350",strokeWidth:2,fillStyle:e=>e.close>=n[0]?.close?"rgba(38, 166, 154, 0.2)":"rgba(239, 83, 80, 0.2)"});case"columns":case"range":return t.createElement(x,{yAccessor:e=>e.close,fillStyle:e=>e.close>=n[0]?.close?"#26a69a":"#ef5350",strokeStyle:e=>e.close>=n[0]?.close?"#26a69a":"#ef5350"});case"highLow":return t.createElement(t.Fragment,null,t.createElement(L,{strokeWidth:1,stroke:e=>"#9EAAC7",yAccessor:e=>({open:e.high,high:e.high,low:e.low,close:e.high})}),t.createElement(H,{yAccessor:e=>e.close,marker:j,markerProps:{r:3,fillStyle:e=>e.close>=n[0]?.close?"#26a69a":"#ef5350",strokeStyle:e=>e.close>=n[0]?.close?"#26a69a":"#ef5350",strokeWidth:1}}));case"heikinAshi":return t.createElement(O,{fill:e=>e.close>e.open?"#26a69a":"#ef5350",stroke:e=>e.close>e.open?"#26a69a":"#ef5350"});case"renko":return t.createElement(R,{fill:{up:"#26a69a",down:"#ef5350",partial:"rgba(38, 166, 154, 0.3)"},stroke:{up:"#26a69a",down:"#ef5350"}});case"kagi":return t.createElement(F,{stroke:{yang:"#26a69a",yin:"#ef5350"},strokeWidth:2,currentValueStroke:"#9EAAC7"});case"pointFigure":return G&&G.length>0&&G[0].boxes?t.createElement(N,{fill:{up:"#26a69a",down:"#ef5350"},stroke:{up:"#26a69a",down:"#ef5350"},strokeWidth:1}):t.createElement(O,{fill:e=>e.close>e.open?"#26a69a":"#ef5350",stroke:e=>e.close>e.open?"#26a69a":"#ef5350"});case"lineBreak":return t.createElement(O,{fill:e=>e.close>e.open?"#26a69a":"#ef5350",stroke:e=>e.close>e.open?"#26a69a":"#ef5350",candleStrokeWidth:1})}})(),t.createElement(An,{origin:[8,16],textFill:On,className:"react-no-select"}),t.createElement(I,z({onReset:()=>$(V+1)},In))),t.createElement(_,_n))});Fn.propTypes={data:l.arrayOf(l.shape({date:l.instanceOf(Date).isRequired,open:l.number.isRequired,high:l.number.isRequired,low:l.number.isRequired,close:l.number.isRequired,volume:l.number.isRequired})).isRequired,dateTimeFormat:l.string,height:l.number,margin:l.object,priceDisplayFormat:l.func,ratio:l.number,width:l.number,axisSettings:l.shape({auto:l.bool,log:l.bool,percent:l.bool}),chartType:l.string},Fn.defaultProps={dateTimeFormat:"%d %b '%y   %H:%M",height:0,margin:{left:0,right:48,top:0,bottom:24},priceDisplayFormat:c(".2f"),ratio:0,width:0};const Rn=Fn,Ln=f({style:{width:"100%",height:"100%"}})(g()(Fn)),Hn={"1 tick":null,"10 ticks":null,"100 ticks":null,"1000 ticks":null,"1 second":1/60,"5 seconds":5/60,"10 seconds":10/60,"15 seconds":.25,"30 seconds":.5,"45 seconds":.75,"1 minute":1,"2 minutes":2,"3 minutes":3,"5 minutes":5,"10 minutes":10,"15 minutes":15,"30 minutes":30,"45 minutes":45,"1 hour":60,"2 hours":120,"3 hours":180,"4 hours":240,"1 day":1440,"1 week":10080,"1 month":43200,"3 months":129600,"6 months":259200,"12 months":525600},jn={"1D":1440,"5D":7200,"1M":43200,"3M":129600,"6M":259200,YTD:null,"1Y":525600,"5Y":2628e3,All:null},Xn={"1D":1,"5D":5,"1M":30,"3M":90,"6M":180,YTD:null,"1Y":365,"5Y":1825,All:null},Yn=(e,t)=>{if("YTD"===t||"All"===t)return!0;if(e.includes("tick")||e.includes("range"))return!0;const n=Hn[e],r=jn[t];return!(!n||!r)&&n<=r},Bn=(e,t)=>`Invalid combination: ${e} interval cannot be used with ${t} range. The interval is larger than the time range.`,Wn=(e,t)=>{if(!e||0===e.length)return e;const n=e[e.length-1].date;let r;switch(t){case"1D":r=new Date(n.getTime()-864e5);break;case"5D":r=new Date(n.getTime()-432e6);break;case"1M":r=new Date(n.getTime()-2592e6);break;case"3M":r=new Date(n.getTime()-7776e6);break;case"6M":r=new Date(n.getTime()-15552e6);break;case"YTD":r=new Date(n.getFullYear(),0,1);break;case"1Y":r=new Date(n.getTime()-31536e6);break;case"5Y":r=new Date(n.getTime()-15768e7);break;default:return e}return e.filter(e=>e.date>=r)},zn=e=>{const t=e?.full||e;if(!t||"string"!=typeof t)return null;const n=t.match(/^(\d+)\s*(\w+)$/);if(!n)return null;const[,r,a]=n;return{value:parseInt(r),unit:a.toLowerCase()}},Vn=(e,t)=>{switch(t){case"second":case"seconds":return e/60;case"minute":case"minutes":return e;case"hour":case"hours":return 60*e;case"day":case"days":return 1440*e;case"week":case"weeks":return 10080*e;case"month":case"months":return 43200*e;default:return null}},$n=(e,t)=>{if(t.includes("tick")||t.includes("range"))return!1;const n=zn(e),r=zn(t);if(!n||!r)return!1;const a=Vn(n.value,n.unit),s=Vn(r.value,r.unit);return!(!a||!s)&&(s>=a&&s%a===0)},Un=e=>{if(!e||0===e.length)return null;const t=e[0],n=e[e.length-1];let r=t.high,a=t.low,s=0;for(const t of e)t.high>r&&(r=t.high),t.low<a&&(a=t.low),s+=t.volume;return{date:t.date,open:t.open,high:r,low:a,close:n.close,volume:s}},Zn=(e,t)=>{if(!e||0===e.length)return e;const n=zn(t);if(!n)return e;const r=Vn(n.value,n.unit);if(!r)return e;if(r<1)throw new Error(`Cannot transform to ${t}: target interval is smaller than source data resolution`);const a=[];let s=[],o=null;for(const t of e){const e=new Date(t.date);let r;if(n.unit.includes("minute")){r=new Date(e);const t=Math.floor(e.getMinutes()/n.value)*n.value;r.setMinutes(t,0,0)}else if(n.unit.includes("hour")){r=new Date(e);const t=Math.floor(e.getHours()/n.value)*n.value;r.setHours(t,0,0,0)}else if(n.unit.includes("day")){if(r=new Date(e),r.setHours(0,0,0,0),n.value>1){const e=Math.floor(r.getTime()/864e5),t=Math.floor(e/n.value)*n.value;r=new Date(1e3*t*60*60*24)}}else if(n.unit.includes("week")){r=new Date(e);const t=(r.getDay()+6)%7;r.setDate(r.getDate()-t),r.setHours(0,0,0,0)}else if(n.unit.includes("month")){if(r=new Date(e.getFullYear(),e.getMonth(),1),n.value>1){const e=Math.floor(r.getMonth()/n.value)*n.value;r.setMonth(e)}}else r=e;if(null===o||r.getTime()!==o.getTime()){if(s.length>0){const e=Un(s);e&&a.push(e)}s=[t],o=r}else s.push(t)}if(s.length>0){const e=Un(s);e&&a.push(e)}return a},qn=(e,t)=>{if(t.includes("tick"))return"Cannot transform to tick-based intervals. Tick data requires specialized market data.";if(t.includes("range"))return"Cannot transform to range-based intervals. Range data requires specialized market data.";const n=zn(e),r=zn(t);if(!n||!r)return"Invalid interval format.";const a=Vn(n.value,n.unit),s=Vn(r.value,r.unit);return a&&s?s<a?`Cannot transform from ${e} to ${t}: target interval is smaller than source data resolution.`:s%a!==0?`Cannot transform from ${e} to ${t}: intervals are not evenly divisible.`:null:"Unsupported time unit."},Gn=t.memo(e=>{let{selectedInterval:n="1D",selectedChartType:a="candles",symbolName:i="BTCUSD",symbolIcon:l="🟠",onIntervalChange:c,onChartTypeChange:h,onUndo:u,onRedo:d}=e;const[p,m]=r(!1),[f,g]=r(!1),v=s(null),b=s(null);o(()=>{const e=e=>{v.current&&!v.current.contains(e.target)&&m(!1),b.current&&!b.current.contains(e.target)&&g(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]);const y={TICKS:[{full:"1 tick",short:"1t"},{full:"10 ticks",short:"10t"},{full:"100 ticks",short:"100t"},{full:"1000 ticks",short:"1000t"}],SECONDS:[{full:"1 second",short:"1s"},{full:"5 seconds",short:"5s"},{full:"10 seconds",short:"10s"},{full:"15 seconds",short:"15s"},{full:"30 seconds",short:"30s"},{full:"45 seconds",short:"45s"}],MINUTES:[{full:"1 minute",short:"1m"},{full:"2 minutes",short:"2m"},{full:"3 minutes",short:"3m"},{full:"5 minutes",short:"5m"},{full:"10 minutes",short:"10m"},{full:"15 minutes",short:"15m"},{full:"30 minutes",short:"30m"},{full:"45 minutes",short:"45m"}],HOURS:[{full:"1 hour",short:"1H"},{full:"2 hours",short:"2H"},{full:"3 hours",short:"3H"},{full:"4 hours",short:"4H"}],DAYS:[{full:"1 day",short:"1D"},{full:"1 week",short:"1W"},{full:"1 month",short:"1M"},{full:"3 months",short:"3M"},{full:"6 months",short:"6M"},{full:"12 months",short:"12M"}],RANGES:[{full:"1 range",short:"1R"},{full:"10 ranges",short:"10R"},{full:"100 ranges",short:"100R"},{full:"1000 ranges",short:"1000R"}]},C=[{id:"bars",label:"Bars",icon:"Bars"},{id:"candles",label:"Candles",icon:"Candlestick"},{id:"hollow",label:"Hollow candles",icon:"HollowCandles"},{id:"volume",label:"Volume candles",icon:"VolumeCandles"},{type:"separator"},{id:"line",label:"Line",icon:"Lines"},{id:"lineMarkers",label:"Line with markers",icon:"LineMarkers"},{id:"step",label:"Step line",icon:"StepLine"},{type:"separator"},{id:"area",label:"Area",icon:"Area"},{id:"hlcArea",label:"HLC area",icon:"HLCArea"},{id:"baseline",label:"Baseline",icon:"Baseline"},{type:"separator"},{id:"columns",label:"Columns",icon:"Columns"},{id:"highLow",label:"High-low",icon:"HighLow"},{type:"separator"},{id:"volumeFootprint",label:"Volume footprint",icon:"VolumeFootprint"},{id:"timePriceOpportunity",label:"Time Price Opportunity",icon:"TimePriceOpportunity"},{id:"sessionVolume",label:"Session volume profile",icon:"SessionVolumeProfile"},{type:"separator"},{id:"heikinAshi",label:"Heikin Ashi",icon:"HeikinAshi"},{id:"renko",label:"Renko",icon:"Renko"},{id:"lineBreak",label:"Line break",icon:"LineBreak"},{id:"kagi",label:"Kagi",icon:"Kagi"},{id:"pointFigure",label:"Point & figure",icon:"PointAndFigure"},{id:"range",label:"Range",icon:"Range"}],w=e=>{switch(e){case"undo":u?u():alert("Undo not implemented");break;case"redo":d?d():alert("Redo not implemented");break;case"indicators":alert("Indicators not implemented");break;case"alert":alert("Alert not implemented");break;case"replay":alert("Replay not implemented");break;default:alert(`${e} not implemented`)}};return t.createElement("div",{className:"topbar"},t.createElement("div",{className:"topbar-left"},t.createElement("div",{className:"topbar-symbol"},t.createElement("span",{className:"symbol-icon"},l),t.createElement("span",{className:"symbol-name"},i)),t.createElement("div",{className:"topbar-divider"}),t.createElement("div",{className:"interval-selector",ref:v},t.createElement("button",{className:"interval-button",onClick:()=>m(!p)},(()=>{if("string"==typeof n){for(const e of Object.values(y))for(const t of e)if(t.full===n)return t.short;return n}return n?.short||n})()),p&&t.createElement("div",{className:"interval-menu"},Object.entries(y).map(e=>{let[r,a]=e;return t.createElement("div",{key:r,className:"interval-category"},t.createElement("div",{className:"interval-category-header"},r),a.map(e=>t.createElement("button",{key:e.full,className:"interval-item "+((n?.full||n)===e.full?"active":""),onClick:()=>(e=>{m(!1),c?c(e):alert(`Interval change to ${e.full} not implemented`)})(e)},e.full)))}))),t.createElement("div",{className:"topbar-divider"}),t.createElement("div",{className:"chart-type-selector",ref:b},t.createElement("button",{className:"chart-type-button",onClick:()=>g(!f)},t.createElement("img",{src:`/TradingViewIcons/${C.find(e=>e.id===a)?.icon||"Candlestick"}.svg`,alt:"Chart type",width:"24",height:"24"})),f&&t.createElement("div",{className:"chart-type-menu"},C.map((e,n)=>"separator"===e.type?t.createElement("div",{key:`separator-${n}`,className:"chart-type-separator"}):t.createElement("button",{key:e.id,className:"chart-type-item "+(e.id===a?"active":""),onClick:()=>(e=>{g(!1),h?h(e.id):alert(`Chart type change to ${e.label} not implemented`)})(e)},t.createElement("img",{src:`/TradingViewIcons/${e.icon}.svg`,alt:e.label,width:"24",height:"24"}),t.createElement("span",null,e.label))))),t.createElement("div",{className:"topbar-divider"}),t.createElement("button",{className:"topbar-icon-btn",onClick:()=>w("indicators"),title:"Indicators"},t.createElement("img",{src:"/TradingViewIcons/Indicator.svg",alt:"Indicators",width:"24",height:"24"}),t.createElement("span",{className:"btn-label"},"Indicators")),t.createElement("div",{className:"topbar-divider"}),t.createElement("button",{className:"topbar-icon-btn",onClick:()=>w("alert"),title:"Alert"},t.createElement("img",{src:"/TradingViewIcons/Target.svg",alt:"Alert",width:"24",height:"24"}),t.createElement("span",{className:"btn-label"},"Alert")),t.createElement("button",{className:"topbar-icon-btn",onClick:()=>w("replay"),title:"Replay"},t.createElement("img",{src:"/TradingViewIcons/Rewind.svg",alt:"Replay",width:"24",height:"24"}),t.createElement("span",{className:"btn-label"},"Replay")),t.createElement("div",{className:"topbar-divider"}),t.createElement("button",{className:"topbar-icon-btn",onClick:()=>w("undo"),title:"Undo"},t.createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24"},t.createElement("path",{d:"M6 12h10a4 4 0 0 1 0 8M6 12l3-3M6 12l3 3",stroke:"currentColor",strokeWidth:"1.5",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"}))),t.createElement("button",{className:"topbar-icon-btn",onClick:()=>w("redo"),title:"Redo"},t.createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24"},t.createElement("path",{d:"M18 12H8a4 4 0 0 0 0 8M18 12l-3-3M18 12l-3 3",stroke:"currentColor",strokeWidth:"1.5",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"})))),t.createElement("div",{className:"topbar-right"},t.createElement("div",{className:"price-info"},t.createElement("span",{className:"price-open"},"O 117,485.1"),t.createElement("span",{className:"price-high"},"H 119,519.8"),t.createElement("span",{className:"price-low"},"L 117,278.6"),t.createElement("span",{className:"price-close"},"C 119,419.4"),t.createElement("span",{className:"price-change positive"},"+1,966.6 (+1.67%)"))))}),Kn=t.memo(()=>{const[e,n]=r(null),[a,i]=r("cursor"),l=s(null);o(()=>{const e=e=>{l.current&&!l.current.contains(e.target)&&n(null)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]);const c=[{category:"LINES",items:[{id:"trendLine",icon:"TrendLine",label:"Trend Line"},{id:"ray",icon:"Ray",label:"Ray"},{id:"infoLine",icon:"InfoLine",label:"Info Line"},{id:"extendedLine",icon:"ExtendedLine",label:"Extended Line"},{id:"trendAngle",icon:"TrendAngle",label:"Trend Angle"},{id:"horizontalLine",icon:"HorizontalLine",label:"Horizontal Line"},{id:"horizontalRay",icon:"HorizontalRay",label:"Horizontal Ray"},{id:"verticalLine",icon:"VerticalLine",label:"Vertical Line"},{id:"crossLine",icon:"CrossLine",label:"Cross Line"}]},{category:"CHANNELS",items:[{id:"parallelChannel",icon:"ParallelChannel",label:"Parallel Channel"},{id:"regressionTrend",icon:"RegressionTrend",label:"Regression Trend"},{id:"flatTopBottom",icon:"FlatTopBottom",label:"Flat Top/Bottom"},{id:"disjointChannel",icon:"DisjointChannel",label:"Disjoint Channel"}]},{category:"PITCHFORKS",items:[{id:"pitchfork",icon:"Pitchfork",label:"Pitchfork"},{id:"schiffPitchfork",icon:"SchiffPitchfork",label:"Schiff Pitchfork"},{id:"modifiedSchiff",icon:"ModifiedSchiffPitchfork",label:"Modified Schiff Pitchfork"},{id:"insidePitchfork",icon:"InsidePitchfork",label:"Inside Pitchfork"}]}],h=[{id:"fibRetracement",icon:"Fibbinoci",label:"Fib Retracement"},{id:"fibExtension",icon:"Trend-BasedFibExtension",label:"Trend-Based Fib Extension"},{id:"fibSpeedFan",icon:"FibSpeedResistanceFan",label:"Fib Speed Resistance Fan"},{id:"fibTimezone",icon:"FibTimeZone",label:"Fib Timezone"},{id:"fibCircles",icon:"FibCircles",label:"Fib Circles"},{id:"fibSpiral",icon:"FibSpiral",label:"Fib Spiral"},{id:"fibChannel",icon:"FibChannel",label:"Fib Channel"},{id:"fibWedge",icon:"FibWedge",label:"Fib Wedge"}],u=[{category:"BRUSHES",items:[{id:"brush",icon:"Brush",label:"Brush"},{id:"highlighter",icon:"Highlighter",label:"Highlighter"}]},{category:"ARROWS",items:[{id:"arrowMarker",icon:"ArrowMarker",label:"Arrow Marker"},{id:"arrow",icon:"Arrow",label:"Arrow"},{id:"arrowUp",icon:"ArrowMarkUp",label:"Arrow Mark Up"},{id:"arrowDown",icon:"ArrowMarkDown",label:"Arrow Mark Down"}]},{category:"SHAPES",items:[{id:"rectangle",icon:"Rectangle",label:"Rectangle"},{id:"rotatedRectangle",icon:"RotatedRectangle",label:"Rotated Rectangle"},{id:"path",icon:"Path",label:"Path"},{id:"circle",icon:"Circle",label:"Circle"},{id:"ellipse",icon:"Ellipse",label:"Ellipse"},{id:"polyline",icon:"Polyline",label:"Polyline"},{id:"triangle",icon:"Triangle",label:"Triangle"},{id:"arc",icon:"Arc",label:"Arc"},{id:"curve",icon:"Curve",label:"Curve"}]}],d=e=>{i(e.id),n(null),alert(`${e.label} not implemented`)};return t.createElement("div",{className:"left-sidebar",ref:l},t.createElement("div",{className:"sidebar-tools"},[{id:"cursor",icon:"CrossLine",label:"Cross Cursor"},{id:"trend",icon:"TrendLine",label:"Trend Line Tools",hasSubmenu:!0},{id:"fibonacci",icon:"Fibbinoci",label:"Fibonacci Tools",hasSubmenu:!0},{id:"patterns",icon:"TrianglePattern",label:"Patterns",hasSubmenu:!0},{id:"forecast",icon:"Forecast",label:"Forecast Tools",hasSubmenu:!0},{id:"measure",icon:"Ruler",label:"Measure Tools",hasSubmenu:!0},{id:"annotation",icon:"Text",label:"Annotation Tools",hasSubmenu:!0},{id:"icons",icon:"FlagMark",label:"Icons",hasSubmenu:!0},{id:"volume",icon:"VolumeCandles",label:"Volume Profile Tools",hasSubmenu:!0},{id:"search",icon:"Search",label:"Search"},{id:"magnet",icon:"Magnet",label:"Magnet Mode"},{id:"drawing-lock",icon:"Unlock",label:"Drawing Lock"},{id:"hide-drawings",icon:"EyePaint",label:"Hide All Drawings"},{id:"remove-drawings",icon:"Trash",label:"Remove All Drawings"}].map(r=>t.createElement("button",{key:r.id,className:"sidebar-tool "+(a===r.id||e===r.id?"active":""),onClick:()=>(t=>{t.hasSubmenu?n(e===t.id?null:t.id):(i(t.id),n(null),["cursor","magnet","drawing-lock","hide-drawings","remove-drawings","search"].includes(t.id)||alert(`${t.label} tool not implemented`))})(r),title:r.label},t.createElement("img",{src:`/TradingViewIcons/${r.icon}.svg`,alt:r.label,width:"24",height:"24"}),r.hasSubmenu&&t.createElement("span",{className:"submenu-indicator"},"▸")))),e&&(()=>{switch(e){case"trend":return t.createElement("div",{className:"submenu"},c.map(e=>t.createElement("div",{key:e.category,className:"submenu-category"},t.createElement("div",{className:"submenu-category-header"},e.category),e.items.map(e=>t.createElement("button",{key:e.id,className:"submenu-item "+(a===e.id?"active":""),onClick:()=>d(e)},t.createElement("img",{src:`/TradingViewIcons/${e.icon}.svg`,alt:e.label,width:"20",height:"20"}),t.createElement("span",null,e.label))))));case"fibonacci":return t.createElement("div",{className:"submenu"},h.map(e=>t.createElement("button",{key:e.id,className:"submenu-item "+(a===e.id?"active":""),onClick:()=>d(e)},t.createElement("img",{src:`/TradingViewIcons/${e.icon}.svg`,alt:e.label,width:"16",height:"16"}),t.createElement("span",null,e.label))));case"annotation":return t.createElement("div",{className:"submenu"},u.map(e=>t.createElement("div",{key:e.category,className:"submenu-category"},t.createElement("div",{className:"submenu-category-header"},e.category),e.items.map(e=>t.createElement("button",{key:e.id,className:"submenu-item "+(a===e.id?"active":""),onClick:()=>d(e)},t.createElement("img",{src:`/TradingViewIcons/${e.icon}.svg`,alt:e.label,width:"20",height:"20"}),t.createElement("span",null,e.label))))));default:return null}})())}),Jn=t.memo(e=>{let{selectedInterval:n={full:"1 day",short:"1D"},selectedRange:a="All",onAxisSettingChange:s,onRangeChange:i}=e;const[l,c]=r(new Date),[h,u]=r({auto:!0,log:!1,percent:!1});o(()=>{const e=setInterval(()=>{c(new Date)},1e3);return()=>clearInterval(e)},[]);const d=e=>{const t={...h};"auto"===e?t.auto=!h.auto:"log"===e?(t.log=!h.log,t.log&&(t.percent=!1)):"percent"===e&&(t.percent=!h.percent,t.percent&&(t.log=!1)),u(t),s&&s(e,t)},p=e=>{const t=((e,t)=>{if(e.includes("tick")){const n=Xn[t];if(!n)return null;const r=1e3*n,a=parseInt(e.split(" ")[0]);return Math.floor(r/a)}if(e.includes("range")){const n=Xn[t];if(!n)return null;const r=100*n,a=parseInt(e.split(" ")[0]);return Math.floor(r/a)}const n=Hn[e],r=jn[t];return n&&r?Math.floor(r/n):null})(n?.full||n,e);return t},m=e=>!Yn(n?.full||n,e),f=e=>{alert(`${e} not implemented`)};return t.createElement("div",{className:"footer-bar"},t.createElement("div",{className:"footer-left"},["1D","5D","1M","3M","6M","YTD","1Y","5Y","All"].map(e=>t.createElement("button",{key:e,className:`range-button ${a===e?"active":""} ${m(e)?"disabled":""}`,onClick:()=>(e=>{const t=n?.full||n;Yn(t,e)?i&&i(e):alert(Bn(t,e))})(e),disabled:m(e),title:m(e)?Bn(n?.full||n,e):`${p(e)} candles`},e))),t.createElement("div",{className:"footer-center"},t.createElement("div",{className:"tradingview-watermark"},t.createElement("img",{src:"/TradingViewIcons/Network.svg",alt:"TradingView",width:"18",height:"18"}),t.createElement("span",null,"TradingView"))),t.createElement("div",{className:"footer-right"},t.createElement("div",{className:"axis-settings"},t.createElement("button",{className:"axis-button "+(h.auto?"active":""),onClick:()=>d("auto"),title:"Auto (fits data to screen)"},"Auto"),t.createElement("button",{className:"axis-button "+(h.log?"active":""),onClick:()=>d("log"),title:"Log Scale"},"Log"),t.createElement("button",{className:"axis-button "+(h.percent?"active":""),onClick:()=>d("percent"),title:"Percentage"},"%")),t.createElement("div",{className:"footer-divider"}),t.createElement("button",{className:"footer-icon-btn",onClick:()=>f("screenshot"),title:"Take a snapshot"},t.createElement("img",{src:"/TradingViewIcons/Camera.svg",alt:"Screenshot",width:"18",height:"18"})),t.createElement("button",{className:"footer-icon-btn",onClick:()=>f("settings"),title:"Settings"},t.createElement("img",{src:"/TradingViewIcons/Nut.svg",alt:"Settings",width:"18",height:"18"})),t.createElement("div",{className:"footer-divider"}),t.createElement("div",{className:"current-time"},l.toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"})+" UTC")))}),Qn=t.memo(e=>{let{data:n,loaded:r,axisSettings:a,error:s,chartType:o}=e;return t.createElement("div",{className:"chart-container"},s?t.createElement("div",{className:"error-message"},t.createElement("h3",null,"Data Transformation Error"),t.createElement("p",null,s),t.createElement("p",null,"Please select a different interval or check your data source.")):r&&n?t.createElement(Ln,{data:n,axisSettings:a,chartType:o}):r&&!n?t.createElement("div",{className:"error-message"},t.createElement("p",null,"No data available for the selected time range and interval.")):t.createElement("div",{className:"loading-message"},"Loading market data..."))}),er=e=>{let{data:n,dataInterval:s="1 minute",symbolName:o="SYMBOL",symbolIcon:l="📈",defaultInterval:c={full:"1 minute",short:"1m"},defaultChartType:h="candles",defaultRange:u="All",showTopBar:d=!0,showLeftSidebar:p=!0,showFooterBar:m=!0,onIntervalChange:f,onChartTypeChange:g,onRangeChange:v,onAxisSettingChange:b,className:y=""}=e;const[C,w]=r(c),[P,E]=r(h),[S,x]=r({auto:!0,log:!1,percent:!1}),[D,k]=r(u),[A,M]=r(null),T=a(()=>{if(!n)return null;try{M(null);const e=C?.full||C;if(!$n(s,e)){const t=qn(s,e);return M(t),null}let t;try{t=Zn(n,e)}catch(e){return M(e.message),null}return Wn(t,D)}catch(e){return console.error("Data processing error:",e),M("Failed to process data"),null}},[n,C,D,s]),I=i(e=>{w(e),f&&f(e)},[f]),_=i(e=>{E(e),g&&g(e)},[g]),O=i((e,t)=>{x(t),b&&b(e,t)},[b]),N=i(e=>{k(e),v&&v(e)},[v]);return t.createElement("div",{className:`app-container ${y}`},d&&t.createElement(Gn,{selectedInterval:C,selectedChartType:P,symbolName:o,symbolIcon:l,onIntervalChange:I,onChartTypeChange:_}),t.createElement("div",{className:"app-content"},p&&t.createElement(Kn,null),t.createElement(Qn,{data:A?null:T,loaded:!0,axisSettings:S,error:A,chartType:P})),m&&t.createElement(Jn,{selectedInterval:C,selectedRange:D,onAxisSettingChange:O,onRangeChange:N}))};er.propTypes={data:l.arrayOf(l.shape({date:l.instanceOf(Date).isRequired,open:l.number.isRequired,high:l.number.isRequired,low:l.number.isRequired,close:l.number.isRequired,volume:l.number.isRequired})).isRequired,dataInterval:l.string,symbolName:l.string,symbolIcon:l.string,defaultInterval:l.oneOfType([l.string,l.shape({full:l.string.isRequired,short:l.string.isRequired})]),defaultChartType:l.string,defaultRange:l.string,showTopBar:l.bool,showLeftSidebar:l.bool,showFooterBar:l.bool,onIntervalChange:l.func,onChartTypeChange:l.func,onRangeChange:l.func,onAxisSettingChange:l.func,className:l.string};const tr=u("%Y-%m-%d");function nr(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"MINUTES",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const[n,a]=r(),[i,l]=r(500);return o(()=>{n||fetch(`https://raw.githubusercontent.com/reactivemarkets/react-financial-charts/master/packages/stories/src/data/${e}.tsv`).then(e=>e.text()).then(e=>W(e,e=>{const t=tr(e.date);e.date=t?new Date(t):new Date(Number(e.date));for(const t in e)"date"!==t&&Object.prototype.hasOwnProperty.call(e,t)&&(e[t]=+e[t]);return e})).then(e=>{a(e)})},[n,e,a]),((e,t)=>{const n=s(null),r=s(e);o(()=>{r.current=e},[e]),o(()=>{const e=()=>r.current();return n.current=window.setInterval(e,t),()=>window.clearInterval(n.current)},[t])})(()=>{n&&t&&l(i+1)},1e3),{data:t?n?.slice(0,i+1):n,loaded:Boolean(n)}}const rr={CANDLES:"candles",BARS:"bars",HOLLOW:"hollow",VOLUME:"volume",LINE:"line",LINE_MARKERS:"lineMarkers",STEP:"step",AREA:"area",HLC_AREA:"hlcArea",BASELINE:"baseline",COLUMNS:"columns",HIGH_LOW:"highLow",HEIKIN_ASHI:"heikinAshi",RENKO:"renko",KAGI:"kagi",POINT_FIGURE:"pointFigure",LINE_BREAK:"lineBreak",RANGE:"range"},ar=[{full:"1 second",short:"1s"},{full:"5 seconds",short:"5s"},{full:"10 seconds",short:"10s"},{full:"15 seconds",short:"15s"},{full:"30 seconds",short:"30s"},{full:"1 minute",short:"1m"},{full:"2 minutes",short:"2m"},{full:"3 minutes",short:"3m"},{full:"5 minutes",short:"5m"},{full:"10 minutes",short:"10m"},{full:"15 minutes",short:"15m"},{full:"30 minutes",short:"30m"},{full:"1 hour",short:"1h"},{full:"2 hours",short:"2h"},{full:"3 hours",short:"3h"},{full:"4 hours",short:"4h"},{full:"6 hours",short:"6h"},{full:"8 hours",short:"8h"},{full:"12 hours",short:"12h"},{full:"1 day",short:"1d"},{full:"3 days",short:"3d"},{full:"1 week",short:"1w"},{full:"1 month",short:"1M"}],sr=["1D","5D","1M","3M","6M","YTD","1Y","5Y","All"];export{rr as CHART_TYPES,Jn as FooterBar,ar as INTERVALS,Kn as LeftSidebar,An as OHLCTooltip,Ln as PriceChart,Rn as PriceChartBase,sr as TIME_RANGES,Gn as TopBar,er as TradingChart,$n as canTransformData,Wn as filterDataByRange,qn as getTransformationError,Zn as transformDataToInterval,nr as useMarketData};
//# sourceMappingURL=index.esm.js.map
